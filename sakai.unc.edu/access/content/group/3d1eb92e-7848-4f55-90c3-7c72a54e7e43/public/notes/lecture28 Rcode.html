<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 28</title>
</head>

<body>

<h2 align="center">R Code for Lecture 28 (Monday, December 3, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter">
<pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># reload data and refit models to wells data</span>
wells <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">read.csv</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ecol 563/wells.txt&quot;</span><span style="color: #009900;">&#41;</span>
out1 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span> n<span style="">-</span>y<span style="color: #009900;">&#41;</span><span style="">~</span> land.use <span style="">+</span> sewer<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
wells<span style="">$</span>land.use2 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">ifelse</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use <span style="">%in%</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'agri'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'undev'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'rural'</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">as.character</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
wells<span style="">$</span>land.use3 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">ifelse</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use2 <span style="">%in%</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'inst'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'recr'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'resL'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'resM'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'trans'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'mixed'</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">as.character</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
wells<span style="">$</span>land.use4 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">ifelse</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use3 <span style="">%in%</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'resH'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'comm'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'indus'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'high.use'</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">as.character</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use3<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
out2d <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="">-</span>y<span style="color: #009900;">&#41;</span><span style="">~</span>land.use4<span style="">+</span>sewer<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
out2i <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="">-</span>y<span style="color: #009900;">&#41;</span> <span style="">~</span> land.use4 <span style="">+</span> sewer <span style="">+</span> nitrate<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># predict returns logits</span>
<span style="color: #003399; font-weight: bold;">predict</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># fitted returns probabilities</span>
<span style="color: #003399; font-weight: bold;">fitted</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># predict with type argument returnes probabilities</span>
<span style="color: #666666; font-style: italic;"># normal-based confidence intervals for them are not appropriate here</span>
<span style="color: #003399; font-weight: bold;">predict</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'response'</span><span style="color: #339933;">,</span> se.fit=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create data frame containing the six unique combinations of sewer and land use</span>
new.dat <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">expand.grid</span><span style="color: #009900;">&#40;</span>land.use4=<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sewer=<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain estimated logits and their standard errors</span>
out.p <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">predict</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #339933;">,</span> se.fit=T<span style="color: #339933;">,</span> newdata=new.dat<span style="color: #009900;">&#41;</span>
out.p
&nbsp;
<span style="color: #666666; font-style: italic;"># create data frame of logits, standard errors, and categories</span>
new.dat2 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">data.frame</span><span style="color: #009900;">&#40;</span>new.dat<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">logit</span>=out.p<span style="">$</span>fit<span style="color: #339933;">,</span> se=out.p<span style="">$</span>se<span style="color: #009900;">&#41;</span>
new.dat2
&nbsp;
<span style="color: #666666; font-style: italic;"># calculate Wald-based confidence intervals for logits</span>
new.dat2<span style="">$</span>low95 <span style="">&lt;-</span> new.dat2<span style="">$</span>logit <span style="">+</span> <span style="color: #003399; font-weight: bold;">qnorm</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #009900;">&#41;</span><span style="">*</span>new.dat2<span style="">$</span>se
new.dat2<span style="">$</span>up95 <span style="">&lt;-</span> new.dat2<span style="">$</span>logit <span style="">+</span> <span style="color: #003399; font-weight: bold;">qnorm</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="">*</span>new.dat2<span style="">$</span>se
new.dat2
&nbsp;
<span style="color: #666666; font-style: italic;"># inverse logit function</span>
<span style="color: #003399; font-weight: bold;">inv.logit</span> <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>eta<span style="color: #009900;">&#41;</span> <span style="color: #003399; font-weight: bold;">exp</span><span style="color: #009900;">&#40;</span>eta<span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">+</span><span style="color: #003399; font-weight: bold;">exp</span><span style="color: #009900;">&#40;</span>eta<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># invert logits and their confidence intervals</span>
<span style="color: #003399; font-weight: bold;">apply</span><span style="color: #009900;">&#40;</span>new.dat2<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="">:</span><span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">inv.logit</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add probabilities and their confidence intervals to data frame</span>
p.dat <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">data.frame</span><span style="color: #009900;">&#40;</span>new.dat<span style="color: #339933;">,</span><span style="color: #003399; font-weight: bold;">apply</span><span style="color: #009900;">&#40;</span>new.dat2<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="">:</span><span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">inv.logit</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
p.dat
<span style="color: #666666; font-style: italic;"># relabel logit column</span>
<span style="color: #003399; font-weight: bold;">names</span><span style="color: #009900;">&#40;</span>p.dat<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <span style="color: #0000ff;">'prob'</span>
p.dat
&nbsp;
<span style="color: #666666; font-style: italic;"># obtaining confidence intervals using profile likelihood</span>
<span style="color: #003399; font-weight: bold;">confint</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># return logits for land use categories when sewer= no</span>
out2d1 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="">-</span>y<span style="color: #009900;">&#41;</span><span style="">~</span>land.use4<span style="">+</span>sewer<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2d<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2d1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># obtain confidence intervals</span>
out.c1 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">confint</span><span style="color: #009900;">&#40;</span>out2d1<span style="color: #009900;">&#41;</span>
out.c1
&nbsp;
<span style="color: #666666; font-style: italic;"># define new sewer factor with sewer=yes the reference group</span>
wells<span style="">$</span>sewer2 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>sewer<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">levels</span>=<span style="color: #003399; font-weight: bold;">rev</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>sewer2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># refit model using new sewer variable</span>
out2d2 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="">-</span>y<span style="color: #009900;">&#41;</span><span style="">~</span>land.use4<span style="">+</span>sewer2<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2d2<span style="color: #009900;">&#41;</span>
&nbsp;
out.c2 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">confint</span><span style="color: #009900;">&#40;</span>out2d2<span style="color: #009900;">&#41;</span>
out.c2 
&nbsp;
<span style="color: #666666; font-style: italic;"># collect results in a matrix</span>
out.profile <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">data.frame</span><span style="color: #009900;">&#40;</span>est=<span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2d1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2d2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">rbind</span><span style="color: #009900;">&#40;</span>out.c1<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>out.c2<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># obtain probabilities</span>
p.dat.profile <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">data.frame</span><span style="color: #009900;">&#40;</span>new.dat<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">inv.logit</span><span style="color: #009900;">&#40;</span>out.profile<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">names</span><span style="color: #009900;">&#40;</span>p.dat.profile<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'prob'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'low95'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'up95'</span><span style="color: #009900;">&#41;</span>
p.dat.profile
&nbsp;
<span style="color: #666666; font-style: italic;">### graph probabilities and their confidence intervals ####</span>
oldmar <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">par</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;mar&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">par</span><span style="color: #009900;">&#40;</span><span style="">mar</span>=<span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">8.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
p.dat<span style="">$</span>both <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">paste</span><span style="color: #009900;">&#40;</span>p.dat<span style="">$</span>sewer<span style="color: #339933;">,</span> p.dat<span style="">$</span>land.use4<span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
p.dat
p.dat<span style="">$</span>num <span style="">&lt;- </span><span style="color: #003399; font-weight: bold;">as.numeric</span><span style="color: #009900;">&#40;</span>p.dat<span style="">$</span>both<span style="color: #009900;">&#41;</span>
p.dat
<span style="color: #003399; font-weight: bold;">plot</span><span style="color: #009900;">&#40;</span>num<span style="">~</span><span style="">prob</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=p.dat<span style="color: #339933;">,</span> xlab=<span style="color: #0000ff;">'Probability of contamination'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> xlim=<span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0.55</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'n'</span><span style="color: #339933;">,</span> axes=F<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">axis</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">axis</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> at=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">6</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">labels</span>=<span style="color: #003399; font-weight: bold;">rep</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'high use'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'mixed use'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'rural'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> las=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex.axis=<span style="color: #cc66cc;">.9</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">box</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">par</span><span style="color: #009900;">&#40;</span>lend=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">segments</span><span style="color: #009900;">&#40;</span>p.dat<span style="">$</span>low95<span style="color: #339933;">,</span> p.dat<span style="">$</span>num<span style="color: #339933;">,</span> p.dat<span style="">$</span>up95<span style="color: #339933;">,</span> p.dat<span style="">$</span>num<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">points</span><span style="color: #009900;">&#40;</span>p.dat<span style="">$</span>prob<span style="color: #339933;">,</span> p.dat<span style="">$</span>num<span style="color: #339933;">,</span> pch=<span style="color: #0000ff;">'|'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">1.5</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">mtext</span><span style="color: #009900;">&#40;</span>side=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> at=<span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">text</span>=<span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Sewers absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'Sewers present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">line</span>=<span style="color: #cc66cc;">5.5</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">1.2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">abline</span><span style="color: #009900;">&#40;</span>h=<span style="color: #cc66cc;">3.5</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">par</span><span style="color: #009900;">&#40;</span><span style="">mar</span>=oldmar<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">### graphing probabilities with continuous predictors ####</span>
<span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># there are no common values of nitrate for all six categories</span>
<span style="color: #003399; font-weight: bold;">tapply</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>nitrate<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">list</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #339933;">,</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">mean</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">tapply</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>nitrate<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">list</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #339933;">,</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">max</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">tapply</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>nitrate<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">list</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #339933;">,</span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">min</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># regression model for the logit</span>
logit.mod <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>mixed<span style="color: #339933;">,</span>rural<span style="color: #339933;">,</span>sewer<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span> <span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="">+</span> <span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>mixed<span style="">+</span><span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="">*</span>rural<span style="">+</span><span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span><span style="">*</span>sewer<span style="">+</span> <span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span><span style="">*</span>x
logit.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># inverse logit for continuous model</span>
prob.mod <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>mixed<span style="color: #339933;">,</span>rural<span style="color: #339933;">,</span>sewer<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span> <span style="color: #003399; font-weight: bold;">exp</span><span style="color: #009900;">&#40;</span>logit.mod<span style="color: #009900;">&#40;</span>mixed<span style="color: #339933;">,</span>rural<span style="color: #339933;">,</span>sewer<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">+</span><span style="color: #003399; font-weight: bold;">exp</span><span style="color: #009900;">&#40;</span>logit.mod<span style="color: #009900;">&#40;</span>mixed<span style="color: #339933;">,</span>rural<span style="color: #339933;">,</span>sewer<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graph over the range of the data</span>
<span style="color: #003399; font-weight: bold;">range</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>nitrate<span style="color: #009900;">&#41;</span>
out.range <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">tapply</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>nitrate<span style="color: #339933;">, </span><span style="color: #003399; font-weight: bold;">list</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #339933;">, </span>wells<span style="">$</span>sewer<span style="color: #009900;">&#41;</span><span style="color: #339933;">, </span><span style="color: #003399; font-weight: bold;">range</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #003399; font-weight: bold;">plot</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0.8</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">7</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.65</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> xlab=<span style="color: #0000ff;">'nitrate'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Probability'</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'n'</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>no <span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>no<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>no<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>yes<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>yes<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">curve</span><span style="color: #009900;">&#40;</span>prob.mod<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> xlim=out.range<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="">$</span>yes<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">legend</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'topleft'</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">rep</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'high use'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'mixed use'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'rural'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #003399; font-weight: bold;">rep</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> lty=<span style="color: #003399; font-weight: bold;">rep</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>each=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.9</span><span style="color: #339933;">,</span> bty=<span style="color: #0000ff;">'n'</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">ncol</span>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">title</span>=<span style="color: #0000ff;">'Sewers absent     Sewers present'</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plotting log odds ratios with continuous and categorical predictors</span>
&nbsp;
wells<span style="">$</span>land.use4a <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">levels</span>=<span style="color: #003399; font-weight: bold;">rev</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">levels</span><span style="color: #009900;">&#40;</span>wells<span style="">$</span>land.use4a<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># refit model so all odds ratios are positive</span>
out2m <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="">-</span>y<span style="color: #009900;">&#41;</span><span style="">~</span>land.use4a<span style="">+</span>sewer<span style="">+</span>nitrate<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=wells<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
out.conf <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">confint</span><span style="color: #009900;">&#40;</span>out2m<span style="color: #009900;">&#41;</span>
out.conf
&nbsp;
<span style="color: #666666; font-style: italic;"># log odds ratios and confidence intervals</span>
out.mod <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">data.frame</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">var</span>=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> est=<span style="color: #003399; font-weight: bold;">coef</span><span style="color: #009900;">&#40;</span>out2m<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> out.conf<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
out.mod
<span style="color: #003399; font-weight: bold;">names</span><span style="color: #009900;">&#40;</span>out.mod<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'low95'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'up95'</span><span style="color: #009900;">&#41;</span>
out.mod
<span style="color: #666666; font-style: italic;"># create labels for log odds ratios</span>
mylabs <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">c</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'land use:<span style="color: #000099; font-weight: bold;">\n</span>mixed use vs rural'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'land use:<span style="color: #000099; font-weight: bold;">\n</span>high use vs rural'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'sewer:<span style="color: #000099; font-weight: bold;">\n</span>yes vs no'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'nitrate:<span style="color: #000099; font-weight: bold;">\n</span>1 mg/l increase'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># prepanel function</span>
myprepanel.ci <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>lx<span style="color: #339933;">,</span>ux<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<span style="color: #003399; font-weight: bold;">list</span><span style="color: #009900;">&#40;</span>xlim=<span style="color: #003399; font-weight: bold;">range</span><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">, </span>ux<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">, </span>lx<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> finite=T<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #003399; font-weight: bold;">library</span><span style="color: #009900;">&#40;</span><span style="">lattice</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">xyplot</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">var</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">labels</span>=mylabs<span style="color: #009900;">&#41;</span><span style="">~</span>est<span style="color: #339933;">,</span> xlab=<span style="color: #0000ff;">'Log odds ratio'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> lx=out.mod<span style="">$</span>low95<span style="color: #339933;">,</span> ux=out.mod<span style="">$</span>up95<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=out.mod<span style="color: #339933;">,</span> prepanel=myprepanel.ci<span style="color: #339933;">,</span> <span style="">panel</span>=<span style="color: #003399; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<span style="color: #003399; font-weight: bold;">panel.segments</span><span style="color: #009900;">&#40;</span>out.mod<span style="">$</span>low95<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> out.mod<span style="">$</span>up95<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span> lineend=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">panel.xyplot</span><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> pch=<span style="color: #0000ff;">'|'</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">1.5</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">panel.abline</span><span style="color: #009900;">&#40;</span>v=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">col</span>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># randomized block design with binomial response</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># read data in from clipboard: Windows</span>
<span style="color: #003399; font-weight: bold;">crabs</span> <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">read.table</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'clipboard'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># read data in from clipboard: Mac OS</span>
<span style="color: #003399; font-weight: bold;">crabs</span> <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">read.table</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">pipe</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pbpaste&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">crabs</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;"># fixed effects randomized block design</span>
out1 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">glm</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span>killed<span style="color: #339933;">,</span><span style="color: #cc66cc;">6</span>-killed<span style="color: #009900;">&#41;</span><span style="">~</span><span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span>Treatment<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span>Block_Number<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=crabs<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">summary</span><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># random effects randomized block design</span>
<span style="color: #003399; font-weight: bold;">library</span><span style="color: #009900;">&#40;</span><span style="">lme4</span><span style="color: #009900;">&#41;</span>
out1.lmer <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">cbind</span><span style="color: #009900;">&#40;</span><span class="r geshifilter-R" style="font-family:monospace;">killed<span style="color: #339933;">,</span><span style="color: #cc66cc;">6</span>-killed</span><span style="color: #009900;">&#41;</span><span style="">~</span><span style="color: #003399; font-weight: bold;">factor</span><span style="color: #009900;">&#40;</span>Treatment<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>Block_Number<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">data</span>=crabs<span style="color: #339933;">,</span> <span style="color: #003399; font-weight: bold;">family</span>=<span style="color: #003399; font-weight: bold;">binomial</span><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">summary</span><span style="color: #009900;">&#40;</span>out1.lmer<span style="color: #009900;">&#41;</span></pre></div></div><p>Created by Pretty R at inside-R.org</p>


</body>
</html>
