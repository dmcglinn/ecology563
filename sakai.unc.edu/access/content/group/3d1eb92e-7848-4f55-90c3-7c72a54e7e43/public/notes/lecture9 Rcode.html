<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 9</title>
</head>

<body>

<h2 align="center">R Code for Lecture 9 (Monday, September 24, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># analysis of covariance where focus is on categorical variable</span>
&nbsp;
ipo <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.delim"><span style="color: #003399; font-weight: bold;">read.delim</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/ipomopsis.txt'</span><span style="color: #009900;">&#41;</span>
ipo<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
out0 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># significant grazing effect</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out0<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grazing has positive effect</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out0<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># t-test with separate variances</span>
<a href="http://inside-r.org/r-doc/stats/t.test"><span style="color: #003399; font-weight: bold;">t.test</span></a><span style="color: #009900;">&#40;</span>Fruit <span style="">~</span> Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> = ipo<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># t-test with pooled variances = ANOVA</span>
<a href="http://inside-r.org/r-doc/stats/t.test"><span style="color: #003399; font-weight: bold;">t.test</span></a><span style="color: #009900;">&#40;</span>Fruit <span style="">~</span> Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> = ipo<span style="color: #339933;">,</span> var.equal=T<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grazing has positve effect</span>
<a href="http://inside-r.org/r-doc/graphics/boxplot"><span style="color: #003399; font-weight: bold;">boxplot</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># display covariate--root size</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Root<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>Grazing<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># change response to ratio</span>
out0a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/I"><span style="color: #003399; font-weight: bold;">I</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">/</span>Root<span style="color: #009900;">&#41;</span><span style="">~</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grazing effect is not significant</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out0a<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grazing has negative effect but not significant</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out0a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># analysis of covariance model</span>
out1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Grazing<span style="">+</span>Root<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># put root first so control for root size</span>
out1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Root<span style="">+</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># now grazing has a significant negative effect</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># model paramters</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add regression model to graph with curve function</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> add=T<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># examine interaction model</span>
out2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Root<span style="">*</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># test whether slopes are the same</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add interaction model to plot</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">## analysis of covariance model where focus is on continuous variable</span>
&nbsp;
goby <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.delim"><span style="color: #003399; font-weight: bold;">read.delim</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/goby.txt'</span><span style="color: #009900;">&#41;</span>
goby<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=refuge<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># separate slopes model</span>
mod1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>refuge<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># slopes in refuge 1 different from refuges 2 and 3</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># refit model with 3 as the reference group</span>
mod1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>refuge<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<span style="color: #cc66cc;">3</span><span style="">:</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># slope for refuge 2 is different from slope for refuge 1</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add separate lines to scatter plot</span>
<a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399; font-weight: bold;">abline</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399; font-weight: bold;">abline</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399; font-weight: bold;">abline</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># reparameterize model so we get estimates of slopes and intercepts for each refuge</span>
mod1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">:</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>refuge<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>refuge<span style="color: #009900;">&#41;</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># the two models are the same</span>
<span style="color: #666666; font-style: italic;"># same MSE</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span><span style="">$</span>sigma
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span><span style="">$</span>sigma
&nbsp;
<span style="color: #666666; font-style: italic;"># same AIC and log-likelihood</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #339933;">,</span>mod1a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># parameterized this way we can use confint to get confidence intervals for the mean</span>
<a href="http://inside-r.org/r-doc/stats/confint"><span style="color: #003399; font-weight: bold;">confint</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># function to construct vector of regressors for use in model</span>
myvec<span style="">&lt;-</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>r<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>r<span style="">==</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> r<span style="">==</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> r<span style="">==</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> x<span style="">*</span><span style="color: #009900;">&#40;</span>r<span style="">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> x<span style="">*</span><span style="color: #009900;">&#40;</span>r<span style="">==</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> x<span style="">*</span><span style="color: #009900;">&#40;</span>r<span style="">==</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># choose one of the densities for refuge 1</span>
goby<span style="">$</span>density<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># values for regressors in for the three refuge values</span>
mydat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>r=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> x=<span style="color: #cc66cc;">1.125</span><span style="color: #009900;">&#41;</span>
mydat
&nbsp;
<span style="color: #666666; font-style: italic;"># create contrast matrix</span>
cmat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>mydat<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> myvec<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
cmat
<span style="color: #666666; font-style: italic;"># C matrix needs to be transposed</span>
cmat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>mydat<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> myvec<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
cmat
<span style="color: #666666; font-style: italic;"># calculate means for each refuge when x = 1.125</span>
cmat<span style="">%*%</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># variance-covariance matrix of means for this choice of x</span>
vmat1 <span style="">&lt;-</span> cmat<span style="">%*%</span><a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span><span style="">%*%</span><a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#41;</span>
vmat1
&nbsp;
<span style="color: #666666; font-style: italic;"># function to calculate difference-adjusted confidence intervals</span>
 ci.func <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>rowvals<span style="color: #339933;">,</span> lm.model<span style="color: #339933;">,</span> glm.vmat<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
nor.func1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>alpha<span style="color: #339933;">,</span> model<span style="color: #339933;">,</span> sig<span style="color: #009900;">&#41;</span> <span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/pt"><span style="color: #003399; font-weight: bold;">pt</span></a><span style="color: #009900;">&#40;</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span>alpha<span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> model<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span> <span style="">*</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>sig<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">/</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="">%*%</span> sig <span style="">%*%</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> model<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span> <span style="">-</span> <a href="http://inside-r.org/r-doc/stats/pt"><span style="color: #003399; font-weight: bold;">pt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span>alpha<span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> model<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span> <span style="">*</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>sig<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">/</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="">%*%</span> sig <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> model<span style="">$</span>df.residual<span style="color: #339933;">,</span> lower.tail=F<span style="color: #009900;">&#41;</span>
nor.func2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>a<span style="color: #339933;">,</span>model<span style="color: #339933;">,</span>sigma<span style="color: #009900;">&#41;</span> nor.func1a<span style="color: #009900;">&#40;</span>a<span style="color: #339933;">,</span>model<span style="color: #339933;">,</span>sigma<span style="color: #009900;">&#41;</span><span style="">-</span><span style="color: #cc66cc;">.95</span>
n <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>rowvals<span style="color: #009900;">&#41;</span>
xvec1b <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/numeric"><span style="color: #003399; font-weight: bold;">numeric</span></a><span style="color: #009900;">&#40;</span>n<span style="">*</span><span style="color: #009900;">&#40;</span>n<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
vmat <span style="">&lt;-</span> glm.vmat<span style="color: #009900;">&#91;</span>rowvals<span style="color: #339933;">,</span>rowvals<span style="color: #009900;">&#93;</span>
ind <span style="">&lt;-</span> <span style="color: #cc66cc;">1</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #009900;">&#40;</span>n<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #009900;">&#40;</span>i<span style="">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="">:</span>n<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
sig <span style="">&lt;-</span> vmat<span style="color: #009900;">&#91;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span>j<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span>j<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;">#solve for alpha</span>
xvec1b<span style="color: #009900;">&#91;</span>ind<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/uniroot"><span style="color: #003399; font-weight: bold;">uniroot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> nor.func2<span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> lm.model<span style="color: #339933;">,</span> sig<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.001</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.999</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">$</span>root
ind <span style="">&lt;-</span> ind<span style="">+</span><span style="color: #cc66cc;">1</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#125;</span>
<span style="color: #cc66cc;">1</span><span style="">-</span>xvec1b
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain confidence levels for comparing three means when x=1.125</span>
ci.func<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> mod1a<span style="color: #339933;">,</span> vmat1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># organize the calculations as a function of density</span>
my.ci <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
mydat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>r=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span>x=x<span style="color: #009900;">&#41;</span>
cmat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>mydat<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> myvec<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
vmat1 <span style="">&lt;-</span> cmat<span style="">%*%</span><a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span><span style="">%*%</span><a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#41;</span>
ci.func<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> mod1a<span style="color: #339933;">,</span> vmat1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># test the function</span>
my.ci<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1.125</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain the difference-adjusted confidence levels for comparing the 3 means at each possible density</span>
<a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">&#40;</span>goby<span style="">$</span>density<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
ci.vals <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">&#40;</span>goby<span style="">$</span>density<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>my.ci<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>ci.vals<span style="color: #009900;">&#41;</span>
ci.vals
&nbsp;
<span style="color: #666666; font-style: italic;"># values range from 0.85 to 0.87</span>
<a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span>ci.vals<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>ci.vals<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot regression lines with 95% and difference-adjusted confidence intervals for mean</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># set up graph</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #339933;">,</span> ylim=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'n'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># select data for refuge 1</span>
cur.x <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">&#40;</span>goby<span style="">$</span>density<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># create matrix of regressors</span>
my.c <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> myvec<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
my.c
<span style="color: #666666; font-style: italic;"># calculate means for those values of the regressors</span>
cur.y <span style="">&lt;-</span> my.c <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
cur.y
<span style="color: #666666; font-style: italic;"># standard errors of the means</span>
cur.se <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>my.c <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>my.c<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add regression lines</span>
<a href="http://inside-r.org/r-doc/graphics/lines"><span style="color: #003399; font-weight: bold;">lines</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% confidence intervals</span>
<a href="http://inside-r.org/r-doc/graphics/segments"><span style="color: #003399; font-weight: bold;">segments</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #339933;">,</span>mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># difference-adjusted confidence intervals</span>
<a href="http://inside-r.org/r-doc/graphics/segments"><span style="color: #003399; font-weight: bold;">segments</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #cc66cc;">.86</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #cc66cc;">.86</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'pink2'</span><span style="color: #339933;">,</span>lwd=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># organize everything as a function of refuge</span>
&nbsp;
plot.func <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>r<span style="color: #339933;">,</span> col1<span style="color: #339933;">,</span> col2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
cur.x<span style="">&lt;-</span><a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">&#40;</span>goby<span style="">$</span>density<span style="color: #009900;">&#91;</span>goby<span style="">$</span>refuge<span style="">==</span>r<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 my.c <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> myvec<span style="color: #009900;">&#40;</span>r<span style="color: #339933;">,</span>x<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
cur.y <span style="">&lt;-</span> my.c <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span>
cur.se <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>my.c <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>mod1a<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>my.c<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/graphics/lines"><span style="color: #003399; font-weight: bold;">lines</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=col1<span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/graphics/segments"><span style="color: #003399; font-weight: bold;">segments</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=col1<span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/graphics/segments"><span style="color: #003399; font-weight: bold;">segments</span></a><span style="color: #009900;">&#40;</span>cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #cc66cc;">.86</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> cur.x<span style="color: #339933;">,</span> cur.y<span style="">+</span><a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #cc66cc;">.86</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> mod1a<span style="">$</span>df.residual<span style="color: #009900;">&#41;</span><span style="">*</span>cur.se<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=col2<span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot regression lines and confidence intervals</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>mortality<span style="">~</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=goby<span style="color: #339933;">,</span> ylim=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'n'</span><span style="color: #009900;">&#41;</span>
plot.func<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'pink2'</span><span style="color: #009900;">&#41;</span>
plot.func<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'dodgerblue4'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'dodgerblue1'</span><span style="color: #009900;">&#41;</span>
plot.func<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'seagreen4'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'seagreen3'</span><span style="color: #009900;">&#41;</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
