<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 24</title>
</head>

<body>

<h2 align="center">R Code for Lecture 24 (Wednesday, November 14, 2012)</h2>
<div style="overflow:auto;">
  <div class="geshifilter">
<pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#### ipomopsis ANCOVA example #####</span>
&nbsp;
ipo <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.delim"><span style="color: #003399; font-weight: bold;">read.delim</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/ipomopsis.txt'</span><span style="color: #009900;">&#41;</span>
out1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Fruit<span style="">~</span>Root<span style="">+</span>Grazing<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=ipo<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/arm"><span style="">arm</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/R2jags"><span style="">R2jags</span></a><span style="color: #009900;">&#41;</span>
x <span style="">&lt;-</span> ipo<span style="">$</span>Root
y <span style="">&lt;-</span> ipo<span style="">$</span>Fruit
<span style="color: #666666; font-style: italic;"># create dummy variable for grazing</span>
z <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>ipo<span style="">$</span>Grazing<span style="color: #009900;">&#41;</span><span style="">-</span><span style="color: #cc66cc;">1</span>
n <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #009900;">&#41;</span>
ipo.data <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;n&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;y&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;z&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;x&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># initial value functions for chains</span>
ipo.inits <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>b0=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b1=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b2=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sigma.y=<a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399; font-weight: bold;">runif</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># parameters whose posterior distributions should be returned</span>
ipo.parms <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;b0&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;b1&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;b2&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;sigma.y&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># set working director to location of BUGS model</span>
<a href="http://inside-r.org/r-doc/base/setwd"><span style="color: #003399; font-weight: bold;">setwd</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;C:/Users/jmweiss/Documents/ecol 563&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### BUGS model ipomodel.txt #####</span>
&nbsp;
model <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># likelihood</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  y<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>y.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> tau.y<span style="color: #009900;">&#41;</span>
  y.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> b0 <span style="">+</span> b1<span style="">*</span>x<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">+</span> b2<span style="">*</span>z<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># priors</span>
b0 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b1 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b2 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># tau.y ~ dgamma(.001,.001)</span>
tau.y <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">pow</span><span style="color: #009900;">&#40;</span>sigma.y<span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
sigma.y <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dunif"><span style="color: #003399; font-weight: bold;">dunif</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10000</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### end BUGS model #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># BUGS run</span>
ipo.1 <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">bugs</span><span style="color: #009900;">&#40;</span>ipo.data<span style="color: #339933;">,</span> ipo.inits<span style="color: #339933;">,</span> ipo.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;ipomodel.txt&quot;</span><span style="color: #339933;">,</span> bugs.directory=<span style="color: #0000ff;">&quot;C:/WinBUGS14&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">1000</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/debug"><span style="color: #003399; font-weight: bold;">debug</span></a>=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># JAGS run</span>
ipo.1.jags <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">jags</span><span style="color: #009900;">&#40;</span>ipo.data<span style="color: #339933;">,</span> ipo.inits<span style="color: #339933;">,</span> ipo.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;ipomodel.txt&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">1000</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># WinBUGS objects returned by JAGS</span>
<a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>ipo.1.jags<span style="">$</span>BUGSoutput<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># convergence diagnostics</span>
ipo.1<span style="">$</span>summary
<a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Rhat&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;n.eff&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># convert to an mcmc object for additional diagnostics</span>
bugsfit.mcmc <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">as.mcmc.list</span><span style="color: #009900;">&#40;</span>ipo.1<span style="color: #009900;">&#41;</span>
jagsfit.mcmc <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">as.mcmc</span><span style="color: #009900;">&#40;</span>ipo.1.jags<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># trace plots of the individual Markov chains</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>bugsfit.mcmc<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># select only the regression parameters</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>bugsfit.mcmc<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;b0&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;b1&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;b2&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># combined Markov chains in matrix format</span>
ipo.1<span style="">$</span>sims.matrix
<span style="color: #666666; font-style: italic;"># combined Markov chains in list format</span>
ipo.1<span style="">$</span>sims.list
<span style="color: #666666; font-style: italic;"># individual Markov chains in the order they were obtained</span>
ipo.1<span style="">$</span>sims.array
&nbsp;
<span style="color: #666666; font-style: italic;"># density plot of posterior distributions for each chain</span>
<a href="http://inside-r.org/r-doc/lattice/densityplot"><span style="color: #003399; font-weight: bold;">densityplot</span></a><span style="color: #009900;">&#40;</span>bugsfit.mcmc<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># percentile credible intervals for parameters</span>
<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>sims.matrix<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>sims.matrix<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/stats/quantile"><span style="color: #003399; font-weight: bold;">quantile</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># compare to frequentist estimates</span>
<a href="http://inside-r.org/r-doc/stats/confint"><span style="color: #003399; font-weight: bold;">confint</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># highest probability density credible intervals</span>
<span style="color: #666666; font-style: italic;"># separately by chain</span>
<span style="color: #003399; font-weight: bold;">HPDinterval</span><span style="color: #009900;">&#40;</span>bugsfit.mcmc<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># combining the three chains for a single estimate</span>
<span style="color: #003399; font-weight: bold;">HPDinterval</span><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">as.mcmc</span><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>sims.matrix<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># compare to percentile intervals</span>
<a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>sims.matrix<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/stats/quantile"><span style="color: #003399; font-weight: bold;">quantile</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graph of posterior densities for each chain</span>
<a href="http://inside-r.org/r-doc/lattice/densityplot"><span style="color: #003399; font-weight: bold;">densityplot</span></a><span style="color: #009900;">&#40;</span>bugsfit.mcmc<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graph of posterior densities combining the chains</span>
<a href="http://inside-r.org/r-doc/lattice/densityplot"><span style="color: #003399; font-weight: bold;">densityplot</span></a><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">as.mcmc</span><span style="color: #009900;">&#40;</span>ipo.1<span style="">$</span>sims.matrix<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># we can also combine chains using rbind and do.call</span>
bugsfit.mcmc<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/lattice/densityplot"><span style="color: #003399; font-weight: bold;">densityplot</span></a><span style="color: #009900;">&#40;</span><span style="color: #003399; font-weight: bold;">as.mcmc</span><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/do.call"><span style="color: #003399; font-weight: bold;">do.call</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/rbind"><span style="color: #003399; font-weight: bold;">rbind</span></a><span style="color: #339933;">,</span>bugsfit.mcmc<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### Bayesian analysis of birds data set #####</span>
&nbsp;
birds<span style=""> &lt;- </span><a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'birds.csv'</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>birds<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># removing observations with missing values for response</span>
birds.short <span style="">&lt;- </span>birds<span style="color: #009900;">&#91;</span><span style="">!</span><a href="http://inside-r.org/r-doc/base/is.na"><span style="color: #003399; font-weight: bold;">is.na</span></a><span style="color: #009900;">&#40;</span>birds<span style="">$</span>S<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>birds<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>birds.short<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># simple model of mean richness by year</span>
out0.glm <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>S<span style="">~</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>year<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=birds.short<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create variables for WinBUGS</span>
y<span style=""> &lt;- </span>birds.short<span style="">$</span>S
<span style="color: #666666; font-style: italic;"># dummy variables for year</span>
year2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>birds.short<span style="">$</span>year<span style="">==</span><span style="color: #cc66cc;">2006</span><span style="color: #009900;">&#41;</span>
year3 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>birds.short<span style="">$</span>year<span style="">==</span><span style="color: #cc66cc;">2007</span><span style="color: #009900;">&#41;</span>
n <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graph of normal priors with decreasing precision</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">/</span><span style="color: #cc66cc;">.01</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> from=<span style="">-</span><span style="color: #cc66cc;">200</span><span style="color: #339933;">,</span> to=<span style="color: #cc66cc;">200</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Density'</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">/</span><span style="color: #cc66cc;">.001</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">/</span><span style="color: #cc66cc;">.0001</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">/</span><span style="color: #cc66cc;">.00001</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### BUGS model model1.txt #####</span>
&nbsp;
model <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># likelihood</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  y<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dpois"><span style="color: #003399; font-weight: bold;">dpois</span></a><span style="color: #009900;">&#40;</span>mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
  <span style="color: #666666; font-style: italic;"># log link</span>
  log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> a <span style="">+</span> b1<span style="">*</span>year2<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">+</span> b2<span style="">*</span>year3<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
  mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span>log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># priors</span>
a <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b1 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b2 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### end BUGS model #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create objects for BUGS run</span>
bird.data <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;y&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;year2&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;year3&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;n&quot;</span><span style="color: #009900;">&#41;</span>
bird.inits <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>a=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b1=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b2=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
bird.parms <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;a&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;b1&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;b2&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit models</span>
mod0.bugs <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">bugs</span><span style="color: #009900;">&#40;</span>bird.data<span style="color: #339933;">,</span> bird.inits<span style="color: #339933;">,</span> bird.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;model1.txt&quot;</span><span style="color: #339933;">,</span> bugs.directory=<span style="color: #0000ff;">&quot;C:/WinBUGS14&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/debug"><span style="color: #003399; font-weight: bold;">debug</span></a>=T<span style="color: #009900;">&#41;</span>
mod0.bugs <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">bugs</span><span style="color: #009900;">&#40;</span>bird.data<span style="color: #339933;">,</span> bird.inits<span style="color: #339933;">,</span> bird.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;model1.txt&quot;</span><span style="color: #339933;">,</span> bugs.directory=<span style="color: #0000ff;">&quot;C:/WinBUGS14&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">1000</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/debug"><span style="color: #003399; font-weight: bold;">debug</span></a>=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># check convergence diagnostics</span>
<span style="color: #666666; font-style: italic;"># ratio of between to within chain variance</span>
<a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span>mod0.bugs<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Rhat&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># effective sample size</span>
<a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>mod0.bugs<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;n.eff&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># examine summaries of posterior distributions</span>
mod0.bugs<span style="">$</span>summary
<span style="color: #666666; font-style: italic;"># compare to frequentist estimates</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out0.glm<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% confidence intervals</span>
<a href="http://inside-r.org/r-doc/stats/confint"><span style="color: #003399; font-weight: bold;">confint</span></a><span style="color: #009900;">&#40;</span>out0.glm<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% percentile credible intervals</span>
<a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>mod0.bugs<span style="">$</span>sims.matrix<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/stats/quantile"><span style="color: #003399; font-weight: bold;">quantile</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># deviance from Bayesian model: Dbar</span>
mod0.bugs<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;deviance&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;mean&quot;</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;"># -2 times log-likelihood from frequentist model: Dhat</span>
<span style="">-</span><span style="color: #cc66cc;">2</span><span style="">*</span><a href="http://inside-r.org/r-doc/stats/logLik"><span style="color: #003399; font-weight: bold;">logLik</span></a><span style="color: #009900;">&#40;</span>out0.glm<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;"># number of effective parameters: Dhat - Dbar</span>
mod0.bugs<span style="">$</span>pD
<span style="color: #666666; font-style: italic;"># analog of AIC</span>
mod0.bugs<span style="">$</span>DIC
&nbsp;
<span style="color: #666666; font-style: italic;">#### BUGS model model2.txt: separate intercepts model #####</span>
&nbsp;
model <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># likelihood</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  y<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dpois"><span style="color: #003399; font-weight: bold;">dpois</span></a><span style="color: #009900;">&#40;</span>mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
  <span style="color: #666666; font-style: italic;"># log link</span>
<span class="r geshifilter-R" style="font-family:monospace;">  log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> a<span style="color: #009900;">&#91;</span>patch<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="">+</span> b1<span style="">*</span>year2<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">+</span> b2<span style="">*</span>year3<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></span>
  mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span>log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># priors</span>
<span class="r geshifilter-R" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>J<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
  a<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span class="r geshifilter-R" style="font-family:monospace;"><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span></span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span></span>
b1 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b2 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### end BUGS model #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># number of patches</span>
J<span style=""> &lt;- </span><a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">&#40;</span>birds.short<span style="">$</span>patch<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># patch identifier renumbered</span>
patch <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>birds.short<span style="">$</span>patch<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># objects for BUGS model</span>
bird.data <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;y&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;year2&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;year3&quot;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;n&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;J&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;patch&quot;</span><span style="color: #009900;">&#41;</span>
bird.inits <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>a=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span>J<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b1=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> b2=<a href="http://inside-r.org/r-doc/stats/rnorm"><span style="color: #003399; font-weight: bold;">rnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
bird.parms <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;a&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;b1&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;b2&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit model</span>
mod1.bugs <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">bugs</span><span style="color: #009900;">&#40;</span>bird.data<span style="color: #339933;">,</span> bird.inits<span style="color: #339933;">,</span> bird.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;model2.txt&quot;</span><span style="color: #339933;">,</span> bugs.directory=<span style="color: #0000ff;">&quot;C:/WinBUGS14&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/debug"><span style="color: #003399; font-weight: bold;">debug</span></a>=T<span style="color: #009900;">&#41;</span>
mod1.bugs <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">bugs</span><span style="color: #009900;">&#40;</span>bird.data<span style="color: #339933;">,</span> bird.inits<span style="color: #339933;">,</span> bird.parms<span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;model2.txt&quot;</span><span style="color: #339933;">,</span> bugs.directory=<span style="color: #0000ff;">&quot;C:/WinBUGS14&quot;</span><span style="color: #339933;">,</span> n.chains=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">10000</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/debug"><span style="color: #003399; font-weight: bold;">debug</span></a>=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># check convergence diagnostics</span>
<a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span>mod1.bugs<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;Rhat&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>mod1.bugs<span style="">$</span>summary<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;n.eff&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># examine summary of posterior distributions</span>
mod1.bugs<span style="">$</span>summary
&nbsp;
<span style="color: #666666; font-style: italic;"># compare models with DIC</span>
mod1.bugs<span style="">$</span>DIC
mod0.bugs<span style="">$</span>DIC
&nbsp;
<span style="color: #666666; font-style: italic;">##### Random intercepts models #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### BUGS model model3.txt #####</span>
&nbsp;
model <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># likelihood</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  y<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dpois"><span style="color: #003399; font-weight: bold;">dpois</span></a><span style="color: #009900;">&#40;</span>mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
  log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> a<span style="color: #009900;">&#91;</span>patch<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="">+</span> b1<span style="">*</span>year2<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">+</span> b2<span style="">*</span>year3<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
  mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span>log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># priors</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>J<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
a<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span>mu.a<span style="color: #339933;">,</span> tau.a<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
b1 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b2 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
mu.a <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
tau.a <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">pow</span><span style="color: #009900;">&#40;</span>sigma.a<span style="color: #339933;">,</span> <span style="">-</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
sigma.a <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dunif"><span style="color: #003399; font-weight: bold;">dunif</span></a><span style="color: #009900;">&#40;<span class="r geshifilter-R" style="font-family:monospace;"><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> </span></span><span style="color: #cc66cc;">10000</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### end BUGS model #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### BUGS model model3a.txt #####</span>
&nbsp;
model <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># likelihood</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  y<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dpois"><span style="color: #003399; font-weight: bold;">dpois</span></a><span style="color: #009900;">&#40;</span>mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
  log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> a<span style="color: #009900;">&#91;</span>patch<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span> <span style="">+</span> b1<span style="">*</span>year2<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">+</span> b2<span style="">*</span>year3<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
  mu.hat<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span>log.mu<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;"># priors</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span>J<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
u0<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> tau.a<span style="color: #009900;">&#41;</span>
a<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> mu.a <span style="">+</span> u0<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span>
<span style="color: #009900;">&#125;</span>
b1 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
b2 <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
mu.a <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dnorm"><span style="color: #003399; font-weight: bold;">dnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.000001</span><span style="color: #009900;">&#41;</span>
tau.a <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">pow</span><span style="color: #009900;">&#40;</span>sigma.a<span style="color: #339933;">,</span> <span style="">-</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
sigma.a <span style="">~</span> <a href="http://inside-r.org/r-doc/stats/dunif"><span style="color: #003399; font-weight: bold;">dunif</span></a><span style="color: #009900;">&#40;<span class="r geshifilter-R" style="font-family:monospace;"><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> </span></span><span style="color: #cc66cc;">10000</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### end BUGS model #####</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
