<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 19</title>
</head>

<body>

<h2 align="center">R Code for Lecture 19 (Monday, October 29, 2012)</h2>
<div style="overflow:auto;">
  <div class="geshifilter">
  <pre class="r geshifilter-R" style="font-family:monospace;">
<span style="color: #666666; font-style: italic;"># fit slugs models from lecture 18</span>
slugs <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'http://www.bio.ic.ac.uk/research/mjcraw/statcomp/data/slugsurvey.txt'</span><span style="color: #339933;">,</span> header=<span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span>
&nbsp;
glm.pois1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>slugs<span style="">~</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#41;</span>
glm.pois2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>slugs<span style="">~</span>field<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/MASS"><span style="">MASS</span></a><span style="color: #009900;">&#41;</span>
glm.NB1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>slugs<span style="">~</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #009900;">&#41;</span>
glm.NB2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>slugs<span style="">~</span>field<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #009900;">&#41;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#41;</span>
glm.NB3 <span style="">&lt;-</span> <a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#40;</span>slugs <span style="">~</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> sigma.formula=<span style="">~</span>field<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=NBI<span style="color: #009900;">&#41;</span>
glm.NB4 <span style="">&lt;-</span> <a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#40;</span>slugs <span style="">~</span> field<span style="color: #339933;">,</span> sigma.formula=<span style="">~</span>field<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=slugs<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=NBI<span style="color: #009900;">&#41;</span>
&nbsp;
LL.glm <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>glm.pois1<span style="color: #339933;">,</span> glm.pois2<span style="color: #339933;">,</span> glm.NB1<span style="color: #339933;">,</span> glm.NB2<span style="color: #339933;">,</span> glm.NB3<span style="color: #339933;">,</span> glm.NB4<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/logLik"><span style="color: #003399; font-weight: bold;">logLik</span></a><span style="color: #009900;">&#41;</span>
k.glm <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.pois1<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.pois2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB1<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> glm.NB1<span style="">$</span>theta<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> glm.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB3<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB3<span style="color: #339933;">,</span> what=<span style="color: #0000ff;">'sigma'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB4<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>glm.NB4<span style="color: #339933;">,</span> what=<span style="color: #0000ff;">'sigma'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#41;</span> 
&nbsp;
labels.glm <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'glm.pois1'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'glm.pois2'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'glm.NB1'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'glm.NB2'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'glm.NB3'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'glm.NB4'</span><span style="color: #009900;">&#41;</span>
output.glm <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>model = labels.glm<span style="color: #339933;">,</span> LL = LL.glm<span style="color: #339933;">,</span> k = k.glm<span style="color: #009900;">&#41;</span>
output.glm
&nbsp;
<span style="color: #666666; font-style: italic;"># calculate AIC</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>glm.pois1<span style="color: #339933;">,</span> glm.pois2<span style="color: #339933;">,</span> glm.NB1<span style="color: #339933;">,</span> glm.NB2<span style="color: #339933;">,</span> glm.NB3<span style="color: #339933;">,</span> glm.NB4<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add AIC to data frames</span>
<a href="http://inside-r.org/r-doc/base/cbind"><span style="color: #003399; font-weight: bold;">cbind</span></a><span style="color: #009900;">&#40;</span>output.glm<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>glm.pois1<span style="color: #339933;">,</span> glm.pois2<span style="color: #339933;">,</span> glm.NB1<span style="color: #339933;">,</span> glm.NB2<span style="color: #339933;">,</span> glm.NB3<span style="color: #339933;">,</span> glm.NB4<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #666666; font-style: italic;">### Galapagos data </span>
gala<span style="">&lt;-</span><a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/galapagos.txt'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># normal model: richness as a function of Area</span>
out.norm1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span>Area<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># normal model: richness as a function of log Area</span>
out.norm2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># compare models</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.norm1<span style="color: #339933;">,</span> out.norm2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot data</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span>Area<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399; font-weight: bold;">abline</span></a><span style="color: #009900;">&#40;</span>out.norm2<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399; font-weight: bold;">abline</span></a><span style="color: #009900;">&#40;</span>out.norm2<span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#Poisson model</span>
out.pois1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.norm1<span style="color: #339933;">,</span> out.norm2<span style="color: #339933;">,</span> out.pois1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add Poisson model to graph</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.pois1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.pois1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="">+</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.pois1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># identity link cannot work with log(Area) because</span>
<span style="color: #666666; font-style: italic;"># some values are negative</span>
out.pois2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#40;</span>link=<a href="http://inside-r.org/r-doc/base/identity"><span style="color: #003399; font-weight: bold;">identity</span></a><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># it does work with Area</span>
out.pois2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span>Area<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/poisson"><span style="color: #003399; font-weight: bold;">poisson</span></a><span style="color: #009900;">&#40;</span>link=<a href="http://inside-r.org/r-doc/base/identity"><span style="color: #003399; font-weight: bold;">identity</span></a><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.norm1<span style="color: #339933;">,</span> out.norm2<span style="color: #339933;">,</span> out.pois1<span style="color: #339933;">,</span> out.pois2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># negative binomial</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/MASS"><span style="">MASS</span></a><span style="color: #009900;">&#41;</span>
out.NB <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.norm1<span style="color: #339933;">,</span> out.norm2<span style="color: #339933;">,</span> out.pois1<span style="color: #339933;">,</span> out.NB<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add negative binomial to graph with Poisson</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.NB<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.NB<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="">+</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.NB<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit NB models with gamlss</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># quadratic mean variance relationship--same as glm.nb</span>
out.gamliss1 <span style="">&lt;-</span> <a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=NBI<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.NB<span style="color: #339933;">, </span>out.gamliss1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># linear mean variance relationship</span>
out.gamliss2 <span style="">&lt;-</span> <a href="http://inside-r.org/packages/cran/gamlss"><span style="">gamlss</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=NBII<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.NB<span style="color: #339933;">, </span>out.gamliss1<span style="color: #339933;">, </span>out.gamliss2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># check mean variance relationship by grouping the response using values of Area</span>
<span style="color: #666666; font-style: italic;"># quintiles of log(Area)</span>
<a href="http://inside-r.org/r-doc/stats/quantile"><span style="color: #003399; font-weight: bold;">quantile</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># group observations into quantiles of Area</span>
out.cut <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/cut"><span style="color: #003399; font-weight: bold;">cut</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/quantile"><span style="color: #003399; font-weight: bold;">quantile</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> include.lowest=T<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># use area groupings to calculate mean and variance of richness</span>
out.m <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="color: #339933;">,</span> out.cut<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">&#41;</span>
out.v <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="color: #339933;">,</span> out.cut<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/var"><span style="color: #003399; font-weight: bold;">var</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot variance versus mean and superimpose quadratic fit</span>
<a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">&#40;</span>out.v<span style="">~</span>out.m<span style="color: #009900;">&#41;</span>
out.r <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>out.v<span style="">~</span>out.m<span style="">+</span><a href="http://inside-r.org/r-doc/base/I"><span style="color: #003399; font-weight: bold;">I</span></a><span style="color: #009900;">&#40;</span>out.m<span style="">^</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.r<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/graphics/curve"><span style="color: #003399; font-weight: bold;">curve</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.r<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="">+</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.r<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="">+</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.r<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="">*</span>x<span style="">^</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> add=T<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
