<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 21</title>
</head>

<body>

<h2 align="center">R Code for Lecture 21 (Monday, November 5, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter">
  <pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">### HW 8 solutions ###</span>
&nbsp;
stirrett <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.delim"><span style="color: #003399; font-weight: bold;">read.delim</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/Stirrett.txt'</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create raw data</span>
trt1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>stirrett<span style="">$</span>Count<span style="color: #339933;">,</span> stirrett<span style="">$</span>Trt1<span style="color: #009900;">&#41;</span>
trt2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>stirrett<span style="">$</span>Count<span style="color: #339933;">,</span> stirrett<span style="">$</span>Trt2<span style="color: #009900;">&#41;</span>
trt3 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>stirrett<span style="">$</span>Count<span style="color: #339933;">,</span> stirrett<span style="">$</span>Trt3<span style="color: #009900;">&#41;</span>
trt4 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>stirrett<span style="">$</span>Count<span style="color: #339933;">,</span> stirrett<span style="">$</span>Trt4<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># assemble results and add a treatment variable</span>
borer <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>count=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>trt1<span style="color: #339933;">,</span> trt2<span style="color: #339933;">,</span> trt3<span style="color: #339933;">,</span> trt4<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> treatment=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>trt1<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>trt2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>trt3<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>trt4<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add the two factors that define the treatments</span>
borer<span style="">$</span>early <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>borer<span style="">$</span>treatment <span style="">%in%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
borer<span style="">$</span>late <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>borer<span style="">$</span>treatment <span style="">%in%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit interaction model</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/MASS"><span style="">MASS</span></a><span style="color: #009900;">&#41;</span>
out.NB1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>count<span style="">~</span>early<span style="">*</span>late<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=borer
<span style="color: #666666; font-style: italic;"># fit one-way design</span>
out.NB1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>count<span style="">~</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>treatment<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=borer<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># two-factor interaction model and one-way design are equivalent</span>
<a href="http://inside-r.org/r-doc/stats/AIC"><span style="color: #003399; font-weight: bold;">AIC</span></a><span style="color: #009900;">&#40;</span>out.NB1<span style="color: #339933;">,</span>out.NB1a<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>out.NB1<span style="color: #339933;">,</span>out.NB1a<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/logLik"><span style="color: #003399; font-weight: bold;">logLik</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># sequential analysis of deviance table</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out.NB1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># refit main effects model</span>
out.NB2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>count<span style="">~</span>early<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=borer<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># mean count of early treatment is 40% that of no treatment</span>
<a href="http://inside-r.org/r-doc/base/exp"><span style="color: #003399; font-weight: bold;">exp</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>out.NB1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### goodness of fit #####</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create data set of counts</span>
junk<span style="">&lt;-</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>Count=<span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">26</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># merge with tabulated data</span>
borer.table <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">&#40;</span>stirrett<span style="color: #339933;">,</span> junk<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/all"><span style="color: #003399; font-weight: bold;">all</span></a>=T<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># change missing values to zero</span>
temp <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/is.na"><span style="color: #003399; font-weight: bold;">is.na</span></a><span style="color: #009900;">&#40;</span>borer.table<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> borer.table<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># assign result to data frame</span>
borer.table<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> temp
borer.table
&nbsp;
<span style="color: #666666; font-style: italic;"># create the counts vector, stack the frequency columns, add a treatment column </span>
final.borer <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>count=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>borer.table<span style="">$</span>Count<span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> freq=<a href="http://inside-r.org/r-doc/base/unlist"><span style="color: #003399; font-weight: bold;">unlist</span></a><span style="color: #009900;">&#40;</span>borer.table<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> treatment=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> each=<a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">&#40;</span>borer.table<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create the early and late factors</span>
final.borer<span style="">$</span>early <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>treatment <span style="">%in%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
final.borer<span style="">$</span>late <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>treatment <span style="">%in%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add predicted treatment mean to the data frame</span>
final.borer<span style="">$</span>mu <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'response'</span><span style="color: #339933;">,</span> newdata=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>early=final.borer<span style="">$</span>early<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># calculate negative binomial probabilities</span>
final.borer<span style="">$</span>p <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/dnbinom"><span style="color: #003399; font-weight: bold;">dnbinom</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>count <span style="color: #339933;">,</span>mu=final.borer<span style="">$</span>mu<span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># probabilities do not sum to one</span>
<a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>p<span style="color: #339933;">,</span> final.borer<span style="">$</span>treatment<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add tail probability to P(X = 26) entry</span>
final.borer<span style="">$</span>p <span style="">&lt;-</span> final.borer<span style="">$</span>p <span style="">+</span> <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>count<span style="">==</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/pnbinom"><span style="color: #003399; font-weight: bold;">pnbinom</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">26</span><span style="color: #339933;">,</span>mu=final.borer<span style="">$</span>mu<span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>p<span style="color: #339933;">,</span>final.borer<span style="">$</span>treatment<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#41;</span>
final.borer<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># count number of observations in each treatment</span>
<a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>freq<span style="color: #339933;">,</span> final.borer<span style="">$</span>treatment<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#41;</span>
n <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/tapply"><span style="color: #003399; font-weight: bold;">tapply</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>freq<span style="color: #339933;">,</span> final.borer<span style="">$</span>treatment<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># calculate expected counts</span>
final.borer<span style="">$</span>exp <span style="">&lt;-</span> final.borer<span style="">$</span>p<span style="">*</span>n<span style="color: #009900;">&#91;</span>final.borer<span style="">$</span>treatment<span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graphical goodness of fit</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lattice"><span style="">lattice</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>freq<span style="">~</span>count<span style="">|</span>early<span style="">+</span>late<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=final.borer<span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'frequency'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'h'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey'</span><span style="color: #339933;">,</span>lineend=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> final.borer<span style="">$</span>exp<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.7</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># improve labeling of the panels</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>freq<span style="">~</span>count<span style="">|</span>factor<span style="color: #009900;">&#40;</span>early<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>early<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Early = &quot;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>early<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Late = &quot;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=final.borer<span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'frequency'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'h'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey'</span><span style="color: #339933;">,</span>lineend=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> final.borer<span style="">$</span>exp<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.7</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># place panels on top and on the left</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/latticeExtra"><span style="">latticeExtra</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>freq<span style="">~</span>count<span style="">|</span>factor<span style="color: #009900;">&#40;</span>early<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>early<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Early = &quot;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>early<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Late = &quot;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>late<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=final.borer<span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'frequency'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'h'</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey'</span><span style="color: #339933;">,</span> lineend=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> final.borer<span style="">$</span>exp<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.7</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span> <span style="">-&gt;</span> mygraph
useOuterStrips<span style="color: #009900;">&#40;</span>mygraph<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># parametric bootstrap goodness of fit</span>
&nbsp;
borer.p <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/split"><span style="color: #003399; font-weight: bold;">split</span></a><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>p<span style="color: #339933;">,</span> final.borer<span style="">$</span>treatmen<span style="color: #009900;">&#41;</span>
 myfunc <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
out.obs <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/as.vector"><span style="color: #003399; font-weight: bold;">as.vector</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/stats/rmultinom"><span style="color: #003399; font-weight: bold;">rmultinom</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> size=n<span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/prob"><span style="">prob</span></a>=borer.p<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>out.obs<span style="">-</span>final.borer<span style="">$</span>exp<span style="color: #009900;">&#41;</span><span style="">^</span><span style="color: #cc66cc;">2</span><span style="">/</span>final.borer<span style="">$</span>exp<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/set.seed"><span style="color: #003399; font-weight: bold;">set.seed</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">100</span><span style="color: #009900;">&#41;</span>
sim.data <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/replicate"><span style="color: #003399; font-weight: bold;">replicate</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">9999</span><span style="color: #339933;">,</span> myfunc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
actual <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>final.borer<span style="">$</span>freq<span style="">-</span>final.borer<span style="">$</span>exp<span style="color: #009900;">&#41;</span><span style="">^</span><span style="color: #cc66cc;">2</span><span style="">/</span>final.borer<span style="">$</span>exp<span style="color: #009900;">&#41;</span>
pearson <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>sim.data<span style="color: #339933;">,</span> actual<span style="color: #009900;">&#41;</span>
pval <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span>pearson<span style="">&gt;=</span>actual<span style="color: #009900;">&#41;</span><span style="">/</span>length<span style="color: #009900;">&#40;</span>pearson<span style="color: #009900;">&#41;</span>
pval
&nbsp;
<span style="color: #666666; font-style: italic;">

########## New material #############</span>
&nbsp;
<span style="color: #666666; font-style: italic;">### goodness of fit for NB model with continuous predictors ####</span>
&nbsp;
gala <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/galapagos.txt'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
out.NB2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/MASS/glm.nb"><span style="color: #003399; font-weight: bold;">glm.nb</span></a><span style="color: #009900;">&#40;</span>Species<span style="">~</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">&#40;</span>Area<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># determine range of observed species counts</span>
<a href="http://inside-r.org/r-doc/base/range"><span style="color: #003399; font-weight: bold;">range</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create probability vectors for each observation</span>
out.p <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">29</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/stats/dnbinom"><span style="color: #003399; font-weight: bold;">dnbinom</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">475</span><span style="color: #339933;">,</span> mu=<a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># determine the largest observation for which probability exceeds 5e-6</span>
<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">29</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">475</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span>out.p<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="">&gt;</span>5e<span style="">-</span>6<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># store this largest count as ux</span>
gala<span style="">$</span>ux <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">29</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">475</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span>out.p<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="">&gt;</span>5e<span style="">-</span>6<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># set lx to be zero</span>
gala<span style="">$</span>lx <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">29</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain maxiumum calculated probability for each island</span>
gala<span style="">$</span>uy <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>out.p<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># minimum probability</span>
gala<span style="">$</span>ly <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">29</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># mean for each island</span>
gala<span style="">$</span>mu<span style="">&lt;-</span><a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># observed probability according to the model</span>
gala<span style="">$</span>z <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/dnbinom"><span style="color: #003399; font-weight: bold;">dnbinom</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="color: #339933;">,</span> mu=<a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>out.NB2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># prepanel function to set limits for each graph</span>
prepanel.ci2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">, </span>y<span style="color: #339933;">,</span> ly<span style="color: #339933;">, </span>lx<span style="color: #339933;">,</span> uy<span style="color: #339933;">,</span> ux<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>ylim=<a href="http://inside-r.org/r-doc/base/range"><span style="color: #003399; font-weight: bold;">range</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span> uy<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> ly<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> finite=T<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> xlim=<a href="http://inside-r.org/r-doc/base/range"><span style="color: #003399; font-weight: bold;">range</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> ux<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> lx<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> finite=T<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot distributions for each island</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>z<span style="">~</span>Species<span style="">|</span>Island<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=gala<span style="color: #339933;">,</span> ux=gala<span style="">$</span>ux<span style="color: #339933;">,</span> lx=gala<span style="">$</span>lx<span style="color: #339933;">,</span> uy=gala<span style="">$</span>uy<span style="color: #339933;">,</span> ly=gala<span style="">$</span>ly<span style="color: #339933;">,</span>
 prepanel=prepanel.ci2<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">475</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/dnbinom"><span style="color: #003399; font-weight: bold;">dnbinom</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="">:</span><span style="color: #cc66cc;">475</span><span style="color: #339933;">,</span> mu=gala<span style="">$</span>mu<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'h'</span><span style="color: #339933;">, </span><a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey'</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.abline"><span style="color: #003399; font-weight: bold;">panel.abline</span></a><span style="color: #009900;">&#40;</span>v=x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
 <a href="http://inside-r.org/r-doc/base/scale"><span style="color: #003399; font-weight: bold;">scale</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #0000ff;">'free'</span><span style="color: #339933;">,</span> y=<span style="color: #0000ff;">'free'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#uppet-tailed p-values</span>
upper.p <span style="">&lt;-</span> <span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/pnbinom"><span style="color: #003399; font-weight: bold;">pnbinom</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> mu=gala<span style="">$</span>mu<span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># number of significant p-values</span>
<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span>upper.p<span style="">&lt;</span><span style="color: #cc66cc;">.05</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># number of significant results expected by chance</span>
<span style="color: #cc66cc;">.05</span><span style="">*</span><span style="color: #cc66cc;">29</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># lower-tailed p-values</span>
lower.p <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/pnbinom"><span style="color: #003399; font-weight: bold;">pnbinom</span></a><span style="color: #009900;">&#40;</span>gala<span style="">$</span>Species<span style="color: #339933;">,</span> mu=gala<span style="">$</span>mu<span style="color: #339933;">,</span> size=out.NB2<span style="">$</span>theta<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span>lower.p<span style="">&lt;</span><span style="color: #cc66cc;">.05</span><span style="color: #009900;">&#41;</span>
lower.p</pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
