<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 10</title>
</head>

<body>

<h2 align="center">R Code for Lecture 10 (Wednesday, September 26, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter">
  <pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># split plot design</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/splityield.txt'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># reorder the levels of density from low to high</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'low'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'medium'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'high'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># aov uses the classical approach to fitting split plot designs</span>
<span style="color: #666666; font-style: italic;"># requires specifying an error term that shows the hierarchical structure</span>
out0 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/aov"><span style="color: #003399; font-weight: bold;">aov</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer <span style="">+</span> Error<span style="color: #009900;">&#40;</span>block<span style="">/</span>irrigation<span style="">/</span>density<span style="">/</span>fertilizer<span style="color: #009900;">&#41;</span><span style="color: #339933;">, </span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out0<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">#the lowest level is not needed</span>
out0 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/aov"><span style="color: #003399; font-weight: bold;">aov</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer <span style="">+</span> Error<span style="color: #009900;">&#40;</span>block<span style="">/</span>irrigation<span style="">/</span>density<span style="color: #009900;">&#41;</span><span style="color: #339933;">, </span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># examine the two-factor interactions</span>
<a href="http://inside-r.org/r-doc/stats/interaction.plot"><span style="color: #003399; font-weight: bold;">interaction.plot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>fertilizer<span style="color: #339933;">, </span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #339933;">, </span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>yield<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/interaction.plot"><span style="color: #003399; font-weight: bold;">interaction.plot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>fertilizer<span style="color: #339933;"> ,</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>irrigation<span style="color: #339933;">, </span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>yield<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/interaction.plot"><span style="color: #003399; font-weight: bold;">interaction.plot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #339933;">, </span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>irrigation<span style="color: #339933;">, </span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>yield<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># split plot design as a mixed effects model</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># use nlme package</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
out0a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="">/</span>irrigation<span style="">/</span>density<span style="color: #339933;">, </span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out0a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># use lme4 package</span>
<a href="http://inside-r.org/r-doc/base/detach"><span style="color: #003399; font-weight: bold;">detach</span></a><span style="color: #009900;">&#40;</span>package<span style="">:</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lme4"><span style="">lme4</span></a><span style="color: #009900;">&#41;</span>
out0b <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer <span style="">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="">/</span>irrigation<span style="">/</span>density<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out0b<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># alternatively we can create a variable the identifies the split plots and split split plots</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># split plot</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>sp1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>irrigation<span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">18</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;"># split split plot</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>sp2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>irrigation<span style="color: #339933;">,</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>density<span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">18</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># now each plot is uniquely identified. To use lmer requires new notation</span>
<span style="color: #666666; font-style: italic;"># does not work</span>
out0c <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer<span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="">/</span>sp1<span style="">/</span>sp2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># this works</span>
out0c <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer<span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>sp1<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>sp2<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out0c<span style="color: #009900;">&#41;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/detach"><span style="color: #003399; font-weight: bold;">detach</span></a><span style="color: #009900;">&#40;</span>package<span style="">:</span><a href="http://inside-r.org/packages/cran/lme4"><span style="">lme4</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># with nlme we can use either variables in the same notation</span>
out0a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>irrigation<span style="">*</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">*</span>fertilizer<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="">/</span>sp1<span style="">/</span>sp2<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># drop nonsignificant interactions</span>
out1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/update"><span style="color: #003399; font-weight: bold;">update</span></a><span style="color: #009900;">&#40;</span>out0a<span style="color: #339933;">, </span>.<span style="">~</span>.<span style="">-</span>irrigation<span style="">:</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">:</span>fertilizer<span style="">-</span><a href="http://inside-r.org/r-doc/stats/density"><span style="color: #003399; font-weight: bold;">density</span></a><span style="">:</span>fertilizer<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out1a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># display final model</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lattice"><span style="">lattice</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># show structure of the design including the blocks</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>density<span style="">|</span>fertilizer<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># same graph as previous graph but written as a pannel function</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>density<span style="">|</span>fertilizer<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">, </span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain predicted mean (marginal) from model and add to data frame</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>out1a<span style="color: #339933;">,</span> level=<span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># first attempt</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>density<span style="">|</span>fertilizer<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;"># change color of observed profiles</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">, </span>...<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># this does not work--we are plotting too much</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">20</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># redo graph using only first 3 means from data frame in each panel</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>density<span style="">|</span>fertilizer<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># save lattice graph as object and use latticeExtra pkg to place strips on top and left</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/latticeExtra"><span style="">latticeExtra</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>density<span style="">|</span>fertilizer<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span> <span style="">-&gt;</span> my.graph
<span style="color: #003399; font-weight: bold;">useOuterStrips</span><span style="color: #009900;">&#40;</span>my.graph<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># compare graph to output of summary table: match estimates to what is shown in graph</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out1a<span style="color: #009900;">&#41;</span><span style="">$</span>tTable
<a href="http://inside-r.org/r-doc/base/round"><span style="color: #003399; font-weight: bold;">round</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out1a<span style="color: #009900;">&#41;</span><span style="">$</span>tTable<span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># repeat summary graph interchanging fertilizer and density to examine second significant interaction</span>
&nbsp;
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>fertilizer<span style="">|</span>density<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># the density values are connected in the wrong order--define factor order to match data frame </span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>fertilizer <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>fertilizer<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'N'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'P'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'NP'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>fertilizer<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># redo graph and save it as an object</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>fertilizer<span style="">|</span>density<span style="">+</span>irrigation<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="color: #339933;">,</span> groups=block<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/sp"><span style="">sp</span></a><span style="">$</span>pred<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span> <span style="">-&gt;</span> my.graph2
<span style="color: #003399; font-weight: bold;">useOuterStrips</span><span style="color: #009900;">&#40;</span>my.graph2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### repeated measures example ######</span>
&nbsp;
turtles<span style=""> &lt;- </span><a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/turtles.txt'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
turtles<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>turtles<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># plot data showing repeated measure structure</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># reorder treatments so levels are in time order</span>
turtles<span style="">$</span>treat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'fed'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'fast10'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'fast20'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit full interaction model accounting for repeated measures structure</span>
turtle1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">*</span>sex<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>turtle1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># drop nonsignificant interaction</span>
turtle2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">+</span>sex<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>turtle2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># the sex effect is not significant--this does not match the earlier graph</span>
<span style="color: #666666; font-style: italic;"># refit model using lmer and carry out mcmc</span>
<a href="http://inside-r.org/r-doc/base/detach"><span style="color: #003399; font-weight: bold;">detach</span></a><span style="color: #009900;">&#40;</span>package<span style="">:</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lme4"><span style="">lme4</span></a><span style="color: #009900;">&#41;</span>
turtle2a <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">+</span>sex<span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>subject<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
out.mc <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">mcmcsamp</span><span style="color: #009900;">&#40;</span>turtle2a<span style="color: #339933;">,</span> n=<span style="color: #cc66cc;">10000</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># 95% credible interval for sex does not include zero</span>
<span style="color: #666666; font-style: italic;"># Bayesian approach disagrees with frequentist approach</span>
<span style="color: #003399; font-weight: bold;">HPDinterval</span><span style="color: #009900;">&#40;</span>out.mc<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>turtle2a<span style="color: #009900;">&#41;</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
