<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 7</title>
</head>

<body>

<h2 align="center">R Code for Lecture 7 (Monday, September 17, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># refit models from last time</span>
plants <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ecol 563/jimsonweed.txt&quot;</span><span style="color: #339933;">,</span> header=T<span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">'<span style="color: #000099; font-weight: bold;">\t</span>'</span><span style="color: #009900;">&#41;</span>
plants<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fixed effects RCBD model</span>
mod2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>lw.rat<span style="">~</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/POT"><span style="">pot</span></a><span style="color: #009900;">&#41;</span><span style="">*</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=plants<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod2<span style="color: #009900;">&#41;</span>
mod1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>lw.rat<span style="">~</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/POT"><span style="">pot</span></a><span style="color: #009900;">&#41;</span><span style="">+</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=plants<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># mixed effects RCBD model using nlme</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
mod2.lme <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>lw.rat<span style="">~</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>pot<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=plants<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/nlme/ranef"><span style="color: #003399; font-weight: bold;">ranef</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #339933;">,</span> level=<span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># mixed effects RCBD model using lme4</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lme4"><span style="">lme4</span></a><span style="color: #009900;">&#41;</span>
mod2.lmer <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>lw.rat<span style="">~</span>type<span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>pot<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=plants<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># there is no predict method for lmer objects</span>
<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399; font-weight: bold;">class</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#determine what functions have special predict methods</span>
<a href="http://inside-r.org/r-doc/utils/methods"><span style="color: #003399; font-weight: bold;">methods</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;predict&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fitted works for both lmer and lme models</span>
<a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>mod2.lme<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #009900;">&#93;</span><a href="http://inside-r.org/r-doc/nlme/ranef"><span style="color: #003399; font-weight: bold;"></span></a>
&nbsp;
<span style="color: #666666; font-style: italic;"># assemble estimates in data frame with raw data</span>
new.dat3 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>plants<span style="color: #339933;">,</span> fix.ests=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>mod1<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> mix.ests=<a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399; font-weight: bold;">fitted</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
new.dat3<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add population-average mean to data frame</span>
new.dat3<span style="">$</span>pop.mean <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span>new.dat3<span style="">$</span>type<span style="">==</span><span style="color: #0000ff;">'G'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="">+</span><a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>mod2.lmer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
new.dat3<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lattice"><span style="">lattice</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># dot plot of raw data</span>
<a href="http://inside-r.org/r-doc/lattice/dotplot"><span style="color: #003399; font-weight: bold;">dotplot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/POT"><span style="">pot</span></a><span style="color: #009900;">&#41;</span><span style="">~</span>lw.rat<span style="">|</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=new.dat3<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># dot plot of raw data using a panel function</span>
<a href="http://inside-r.org/r-doc/lattice/dotplot"><span style="color: #003399; font-weight: bold;">dotplot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/POT"><span style="">pot</span></a><span style="color: #009900;">&#41;</span><span style="">~</span>lw.rat<span style="">|</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=new.dat3<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.grid"><span style="color: #003399; font-weight: bold;">panel.grid</span></a><span style="color: #009900;">&#40;</span>v=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> h=<span style="">-</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/jitter"><span style="color: #003399; font-weight: bold;">jitter</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.5</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># dot plot of raw data plus treatment and block means</span>
<a href="http://inside-r.org/r-doc/lattice/dotplot"><span style="color: #003399; font-weight: bold;">dotplot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/POT"><span style="">pot</span></a><span style="color: #009900;">&#41;</span><span style="">~</span>lw.rat<span style="">|</span>type<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=new.dat3<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>subscripts<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.grid"><span style="color: #003399; font-weight: bold;">panel.grid</span></a><span style="color: #009900;">&#40;</span>v=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> h=<span style="">-</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/jitter"><span style="color: #003399; font-weight: bold;">jitter</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.5</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.points"><span style="color: #003399; font-weight: bold;">panel.points</span></a><span style="color: #009900;">&#40;</span>new.dat3<span style="">$</span>fix.ests<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.points"><span style="color: #003399; font-weight: bold;">panel.points</span></a><span style="color: #009900;">&#40;</span>new.dat3<span style="">$</span>mix.ests<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.abline"><span style="color: #003399; font-weight: bold;">panel.abline</span></a><span style="color: #009900;">&#40;</span>v=new.dat3<span style="">$</span>pop.mean<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'seagreen'</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>scales=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #0000ff;">'free'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># RCBD with no replication of treatments within blocks</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/faraway"><span style="">faraway</span></a><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #009900;">&#40;</span>oatvar<span style="color: #009900;">&#41;</span>
oatvar<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>oatvar<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">&#40;</span>oatvar<span style="">$</span>block<span style="color: #339933;">,</span>oatvar<span style="">$</span>variety<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># additive model</span>
g <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>block<span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>variety<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=oatvar<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># interaction model does not yield standard error estimates</span>
g2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>yield<span style="">~</span>block<span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>variety<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=oatvar<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>g2<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>g2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># Tukey test for non-additivity</span>
<a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #009900;">&#41;</span>
blockcoefs <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="">:</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
trtcoefs <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/coef"><span style="color: #003399; font-weight: bold;">coef</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">6</span><span style="">:</span><span style="color: #cc66cc;">12</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
oatvar<span style="">$</span>alpha.gamma <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>trtcoefs<span style="color: #339933;">,</span> each=<span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span> <span style="">*</span> <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span>blockcoefs<span style="color: #339933;">,</span><span style="color: #cc66cc;">8</span><span style="color: #009900;">&#41;</span>
oatvar<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
g1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/update"><span style="color: #003399; font-weight: bold;">update</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span> .<span style="">~</span>. <span style="">+</span>alpha.gamma<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>g1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graphical checks for block x treatment interaction</span>
<a href="http://inside-r.org/r-doc/lattice/dotplot"><span style="color: #003399; font-weight: bold;">dotplot</span></a><span style="color: #009900;">&#40;</span>block<span style="">~</span>yield<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a>=variety<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=oatvar<span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/interaction.plot"><span style="color: #003399; font-weight: bold;">interaction.plot</span></a><span style="color: #009900;">&#40;</span>oatvar<span style="">$</span>variety<span style="color: #339933;">,</span> oatvar<span style="">$</span>block<span style="color: #339933;">,</span> oatvar<span style="">$</span>yield<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># complicated ANOVA models with two kinds of blocks</span>
nitro <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/nitro.csv'</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a><span style="color: #009900;">&#40;</span>nitro<span style="color: #009900;">&#41;</span>
nitro<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">&#40;</span>nitro<span style="">$</span>lh<span style="color: #339933;">,</span> nitro<span style="">$</span>func<span style="color: #339933;">,</span> nitro<span style="">$</span>n<span style="color: #339933;">,</span> nitro<span style="">$</span>p<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#create a treatment variable</span>
nitro<span style="">$</span>trt <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span>nitro<span style="">$</span>lh<span style="color: #339933;">,</span> nitro<span style="">$</span>func<span style="color: #339933;">,</span> nitro<span style="">$</span>n<span style="color: #339933;">,</span> nitro<span style="">$</span>p<span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">'.'</span><span style="color: #009900;">&#41;</span>
nitro<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># not all treatments are represented in each block</span>
<a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">&#40;</span>nitro<span style="">$</span>trt<span style="color: #339933;">,</span> nitro<span style="">$</span>block<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">&#40;</span>nitro<span style="">$</span>trt<span style="color: #339933;">,</span> nitro<span style="">$</span>phy<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># response varies by phy</span>
<a href="http://inside-r.org/r-doc/graphics/boxplot"><span style="color: #003399; font-weight: bold;">boxplot</span></a><span style="color: #009900;">&#40;</span>pN<span style="">~</span>phy<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># 4-factor ANOVA model with blocks</span>
mod3 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>pN<span style="">^</span><span style="color: #cc66cc;">2</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>block<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>phy<span style="color: #009900;">&#41;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>n<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#91;</span>nitro<span style="">$</span>tag<span style="">!</span>=<span style="color: #cc66cc;">444</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 6-factor interaction model fails to estimate</span>
mod0 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>pN<span style="">^</span><span style="color: #cc66cc;">2</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>block<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>phy<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>n<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#91;</span>nitro<span style="">$</span>tag<span style="">!</span>=<span style="color: #cc66cc;">444</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod0<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># compare Type I and Type II tests</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/car"><span style="">car</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">Anova</span><span style="color: #009900;">&#40;</span>mod3<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># drop 4-factor and 3-factor interactions</span>
mod3a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>pN<span style="">^</span><span style="color: #cc66cc;">2</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>block<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>phy<span style="color: #009900;">&#41;</span> <span style="">+</span> <span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>n<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">^</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#91;</span>nitro<span style="">$</span>tag<span style="">!</span>=<span style="color: #cc66cc;">444</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3a<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add back in 3-factor interaction with lowest p-value</span>
mod3b <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/update"><span style="color: #003399; font-weight: bold;">update</span></a><span style="color: #009900;">&#40;</span>mod3a<span style="color: #339933;">,</span> .<span style="">~</span>. <span style="">+</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">:</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">:</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3b<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3a<span style="color: #009900;">&#41;</span>
<span style="color: #003399; font-weight: bold;">Anova</span><span style="color: #009900;">&#40;</span>mod3a<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># final model with one two-factor interaction</span>
mod3c <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>pN<span style="">^</span><span style="color: #cc66cc;">2</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>block<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>phy<span style="color: #009900;">&#41;</span> <span style="">+</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>n<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#91;</span>nitro<span style="">$</span>tag<span style="">!</span>=<span style="color: #cc66cc;">444</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3c<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># mixed effects model with crossed random effects: block and phy</span>
mod3.lmer <span style="">&lt;-</span> <span style="color: #003399; font-weight: bold;">lmer</span><span style="color: #009900;">&#40;</span>pN<span style="">^</span><span style="color: #cc66cc;">2</span> <span style="">~</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/datasets/lh"><span style="color: #003399; font-weight: bold;">lh</span></a><span style="color: #009900;">&#41;</span><span style="">*</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>n<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>func<span style="color: #009900;">&#41;</span><span style="">+</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>p<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="color: #009900;">&#41;</span><span style="">+</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">|</span>phy<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=nitro<span style="color: #009900;">&#91;</span>nitro<span style="">$</span>tag<span style="">!</span>=<span style="color: #cc66cc;">444</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>mod3.lmer<span style="color: #009900;">&#41;</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
