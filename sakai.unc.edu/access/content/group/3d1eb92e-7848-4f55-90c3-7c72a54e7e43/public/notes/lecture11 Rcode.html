<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>R code for lecture 11</title>
</head>

<body>

<h2 align="center">R Code for Lecture 11 (Monday, October 1, 2012)</h2>
<div style="overflow:auto;"><div class="geshifilter">
  <pre class="r geshifilter-R" style="font-family:monospace;">poplars <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/poplars.txt'</span><span style="color: #339933;">,</span> header=T<span style="color: #009900;">&#41;</span>
poplars<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># split the values of trt into individual characters</span>
out.sp <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/strsplit"><span style="color: #003399; font-weight: bold;">strsplit</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/as.character"><span style="color: #003399; font-weight: bold;">as.character</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>trt<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/split"><span style="color: #003399; font-weight: bold;">split</span></a>=<span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># out.sp is a list</span>
out.sp
out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span>
out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">47</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span>
out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">47</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># testing the whole list does not work</span>
<span style="color: #0000ff;">'L'</span> <span style="">%in%</span> out.sp
&nbsp;
<span style="color: #666666; font-style: italic;"># use sapply to test one observation at a time</span>
<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>out.sp<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <span style="color: #0000ff;">'L'</span> <span style="">%in%</span> x<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># alternative use of sapply</span>
<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <span style="color: #0000ff;">'L'</span> <span style="">%in%</span> out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># make the sapply expression the first argument of ifelse</span>
<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <span style="color: #0000ff;">'L'</span> <span style="">%in%</span> out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># convert the result to a factor</span>
L <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">48</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <span style="color: #0000ff;">'L'</span> <span style="">%in%</span> out.sp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span>x<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
L
&nbsp;
<span style="color: #666666; font-style: italic;"># second method using grep</span>
<span style="color: #666666; font-style: italic;"># create a clean copy of poplars</span>
poplars2 <span style="">&lt;-</span> poplars<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span>
poplars2<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;"># create a variable L all of whose values are 'absent'</span>
poplars2<span style="">$</span>L <span style="">&lt;-</span> <span style="color: #0000ff;">'absent'</span>
poplars2<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #009900;">&#93;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># grep is one of a family of search and replace functions</span>
<span style="">?</span><a href="http://inside-r.org/r-doc/base/grep"><span style="color: #003399; font-weight: bold;">grep</span></a>
<span style="color: #666666; font-style: italic;"># grep returns the locations in the vector trt where 'L' is found</span>
<a href="http://inside-r.org/r-doc/base/grep"><span style="color: #003399; font-weight: bold;">grep</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> poplars2<span style="">$</span>trt<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># use the locations change the value of trt to 'present'</span>
poplars2<span style="">$</span>L<span style="color: #009900;">&#91;</span><a href="http://inside-r.org/r-doc/base/grep"><span style="color: #003399; font-weight: bold;">grep</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> poplars2<span style="">$</span>trt<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <span style="color: #0000ff;">'present'</span>
poplars2<span style="">$</span>L
<span style="color: #666666; font-style: italic;">#convert the result to a factor</span>
poplars2<span style="">$</span>L <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>poplars2<span style="">$</span>L<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># graphically test for a treatment x block interaction</span>
<a href="http://inside-r.org/r-doc/stats/interaction.plot"><span style="color: #003399; font-weight: bold;">interaction.plot</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>trt<span style="color: #339933;">, </span>poplars<span style="">$</span>block<span style="color: #339933;">, </span>poplars<span style="">$</span>weight<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># fit the full interaction model with blocks</span>
out1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">&#40;</span>weight<span style="">~</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>block<span style="color: #009900;">&#41;</span><span style="">+</span>L<span style="">*</span>P<span style="">*</span>N<span style="">*</span>K<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=poplars<span style="color: #009900;">&#41;</span> 
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># compare the output to the random effects version of the model</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/nlme/nlme"><span style="color: #003399; font-weight: bold;">nlme</span></a><span style="color: #009900;">&#41;</span>
lme.model <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>weight<span style="">~</span>L<span style="">*</span>P<span style="">*</span>N<span style="">*</span>K<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=poplars<span style="color: #009900;">&#41;</span> 
&nbsp;
<span style="color: #666666; font-style: italic;"># the F-tests are nearly the same as the fixed blocks version so we can trust them</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>lme.model<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># drop non-significant interactions</span>
lme.model2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>weight<span style="">~</span>L<span style="">*</span>N <span style="">+</span> P <span style="">+ </span>K<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=poplars<span style="color: #009900;">&#41;</span> 
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># drop non-significant main effect</span>
lme.model2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>weight<span style="">~</span>L<span style="">*</span>N <span style="">+</span> P<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>block<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=poplars<span style="color: #009900;">&#41;</span> 
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>L<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># create a data frame of the unique combinations of L and N</span>
g <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/expand.grid"><span style="color: #003399; font-weight: bold;">expand.grid</span></a><span style="color: #009900;">&#40;</span>L=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>L<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> N=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>N<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
g
<a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># write a function to return values of the regressors for choices of L, N, and P</span>
cvec <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>L<span style="color: #339933;">,</span>N<span style="color: #339933;">,</span>P<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">, </span>L<span style="">==</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">, </span>N<span style="">==</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">, </span>P<span style="">==</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">, </span><span style="color: #009900;">&#40;</span>L<span style="">==</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="">*</span><span style="color: #009900;">&#40;</span>N<span style="">==</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># make function to obtain regressors for all combinations of L and N for a specific P</span>
cmat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>P<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> cvec<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> P<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># construct regressors when P = 'absent'</span>
cmat1 <span style="">&lt;-</span> cmat<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># construct regressors when P = 'present'</span>
cmat2 <span style="">&lt;-</span> cmat<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span>
cmat1
cmat2
&nbsp;
<span style="color: #666666; font-style: italic;"># difference-adjusted confidence interval function from lecture 8</span>
ci.func2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>rowvals<span style="color: #339933;">,</span> glm.vmat<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
nor.func1a <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>alpha<span style="color: #339933;">,</span> sig<span style="color: #009900;">&#41;</span> <span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">&#40;</span><span style="">-</span><a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span>alpha<span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> <span style="">*</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>sig<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">/</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="">%*%</span> sig <span style="">%*%</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">-</span> <a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span>alpha<span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> <span style="">*</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>sig<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">/</span> <a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="">%*%</span> sig <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> lower.tail=F<span style="color: #009900;">&#41;</span>
nor.func2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>a<span style="color: #339933;">,</span>sigma<span style="color: #009900;">&#41;</span> nor.func1a<span style="color: #009900;">&#40;</span>a<span style="color: #339933;">,</span>sigma<span style="color: #009900;">&#41;</span><span style="">-</span><span style="color: #cc66cc;">.95</span>
n <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">&#40;</span>rowvals<span style="color: #009900;">&#41;</span>
xvec1b <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/numeric"><span style="color: #003399; font-weight: bold;">numeric</span></a><span style="color: #009900;">&#40;</span>n<span style="">*</span><span style="color: #009900;">&#40;</span>n<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span>
vmat <span style="">&lt;-</span> glm.vmat<span style="color: #009900;">&#91;</span>rowvals<span style="color: #339933;">,</span>rowvals<span style="color: #009900;">&#93;</span>
ind <span style="">&lt;-</span> <span style="color: #cc66cc;">1</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #009900;">&#40;</span>n<span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #000000; font-weight: bold;">for</span><span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #009900;">&#40;</span>i<span style="">+</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="">:</span>n<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
sig <span style="">&lt;-</span> vmat<span style="color: #009900;">&#91;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span>j<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span>j<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span>
<span style="color: #666666; font-style: italic;">#solve for alpha</span>
xvec1b<span style="color: #009900;">&#91;</span>ind<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/uniroot"><span style="color: #003399; font-weight: bold;">uniroot</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> nor.func2<span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> sig<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.001</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.999</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">$</span>root
ind <span style="">&lt;-</span> ind<span style="">+</span><span style="color: #cc66cc;">1</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#125;</span>
<span style="color: #cc66cc;">1</span><span style="">-</span>xvec1b
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># in turth we could use a t-distribution rather than a normal distribution</span>
<a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>lme.model<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># degrees of freedom are located in the $fixDF$X component</span>
lme.model2<span style="">$</span>fixDF<span style="">$</span>X
&nbsp;
<span style="color: #666666; font-style: italic;"># choosing t or normal makes a small difference here</span>
<a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/qt"><span style="color: #003399; font-weight: bold;">qt</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">41</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain variance-covariance matrices of the treatment means</span>
vmat1 <span style="">&lt;-</span> cmat1 <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat1<span style="color: #009900;">&#41;</span>
vmat2 <span style="">&lt;-</span> cmat2 <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain difference-adjusted confidence intervals</span>
ci.func2<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span>vmat1<span style="color: #009900;">&#41;</span>
ci.func2<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span>vmat2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># rewrite the make.data function from lecture 9 to work here</span>
make.data <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span>model<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;">#variance-covariance matrix of the means</span>
vmat <span style="">&lt;-</span> cmat<span style="color: #009900;">&#40;</span>P<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#40;</span>P<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># difference-adjusted confidence levels</span>
vals1 <span style="">&lt;-</span> ci.func2<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/as.matrix"><span style="color: #003399; font-weight: bold;">as.matrix</span></a><span style="color: #009900;">&#40;</span>vmat<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># levels of lh and n, means, and standard errors</span>
part1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span>
est=<a href="http://inside-r.org/r-doc/base/as.vector"><span style="color: #003399; font-weight: bold;">as.vector</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#40;</span>P<span style="color: #009900;">&#41;</span><span style="">%*%</span><a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> se=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>vmat<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% intervals</span>
part1<span style="">$</span>low95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># difference-adjusted intervals</span>
part1<span style="">$</span>low85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># add value of func and p</span>
part1<span style="">$</span>P <span style="">&lt;-</span> P
<span style="color: #666666; font-style: italic;"># return value of function</span>
part1
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># generate data for the graph</span>
part0a <span style="">&lt;-</span> make.data<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span>lme.model2<span style="color: #009900;">&#41;</span>
part0b <span style="">&lt;-</span> make.data<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'present'</span><span style="color: #339933;">,</span>lme.model2<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># combine into a single data frame</span>
fac.vals <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/rbind"><span style="color: #003399; font-weight: bold;">rbind</span></a><span style="color: #009900;">&#40;</span>part0a<span style="color: #339933;">,</span>part0b<span style="color: #009900;">&#41;</span>
fac.vals
&nbsp;
<span style="color: #666666; font-style: italic;"># the only change needed for the group panels function is for the grid lines</span>
 my.panel <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #339933;">,</span> pch<span style="color: #339933;">,</span> group.number<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;">#subset variables for the current panel</span>
low95 <span style="">&lt;-</span> fac.vals<span style="">$</span>low95<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
up95 <span style="">&lt;-</span> fac.vals<span style="">$</span>up95<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
low85 <span style="">&lt;-</span> fac.vals<span style="">$</span>low85<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
up85 <span style="">&lt;-</span> fac.vals<span style="">$</span>up85<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
myjitter <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="">-</span><span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.05</span><span style="color: #009900;">&#41;</span>
col2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'tomato'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'grey60'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">#95% confidence interval</span>
<a href="http://inside-r.org/r-doc/lattice/panel.arrows"><span style="color: #003399; font-weight: bold;">panel.arrows</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> low95<span style="color: #339933;">,</span> x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> up95<span style="color: #339933;">,</span> angle=<span style="color: #cc66cc;">90</span><span style="color: #339933;">,</span> code=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a>=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">#difference-adjusted confidence interval</span>
<a href="http://inside-r.org/r-doc/lattice/panel.segments"><span style="color: #003399; font-weight: bold;">panel.segments</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> low85<span style="color: #339933;">,</span> x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> up85<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=col2<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> lineend=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># connect means with line segments</span>
<a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add point estimates for the means</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'white'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #339933;">,</span> pch=pch<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grid lines</span>
<a href="http://inside-r.org/r-doc/lattice/panel.abline"><span style="color: #003399; font-weight: bold;">panel.abline</span></a><span style="color: #009900;">&#40;</span>h=<a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">70</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'lightgrey'</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># prepanel function needs no changes</span>
 prepanel.ci2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> ly<span style="color: #339933;">,</span> uy<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>ylim=<a href="http://inside-r.org/r-doc/base/range"><span style="color: #003399; font-weight: bold;">range</span></a><span style="color: #009900;">&#40;</span>y<span style="color: #339933;">,</span> uy<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> ly<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> finite=T<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># P is not a factor</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>fac.vals<span style="">$</span>P<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/packages/cran/lattice"><span style="">lattice</span></a><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># modidy the xyplot call to work with the current data set</span>
<span style="color: #666666; font-style: italic;"># change x-variable, conditioning variable, groups variable, x-axis labael, and the layout</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>est<span style="">~</span>L<span style="">|</span>factor<span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span> level=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'P = '</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> xlab =<span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Estimated mean'</span><span style="color: #339933;">,</span> groups=N<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=fac.vals<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> prepanel=prepanel.ci2<span style="color: #339933;">,</span> ly=fac.vals<span style="">$</span>low95<span style="color: #339933;">,</span> uy=fac.vals<span style="">$</span>up95<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> panel.groups=my.panel<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<span style="color: #0000ff;">&quot;panel.superpose&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># redo graph with a legend</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>est<span style="">~</span>L<span style="">|</span>factor<span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span> level=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'P = '</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> xlab =<span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Estimated mean'</span><span style="color: #339933;">,</span> groups=N<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=fac.vals<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> prepanel=prepanel.ci2<span style="color: #339933;">,</span> ly=fac.vals<span style="">$</span>low95<span style="color: #339933;">,</span> uy=fac.vals<span style="">$</span>up95<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> panel.groups=my.panel<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<span style="color: #0000ff;">&quot;panel.superpose&quot;</span><span style="color: #339933;">,</span> key=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> y=<span style="color: #cc66cc;">.82</span><span style="color: #339933;">,</span> corner=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/points"><span style="color: #003399; font-weight: bold;">points</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.9</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/text"><span style="color: #003399; font-weight: bold;">text</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'N = 1'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'N = 0'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.8</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># check to see if graphical tests coincide with summary table. The test across panels is wrong.</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># generate values of L, N, and P for all 8 means together</span>
g <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/expand.grid"><span style="color: #003399; font-weight: bold;">expand.grid</span></a><span style="color: #009900;">&#40;</span>L=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>L<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> N=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>N<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> P=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>poplars<span style="">$</span>P<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
g
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain values of the regressors for each of the 8 means</span>
cmat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> cvec<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
cmat
<span style="color: #666666; font-style: italic;"># obtain the variance-covariance matrix of the means</span>
vmat <span style="">&lt;-</span> cmat <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>lme.model2<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain difference-adjusted confidence levels</span>
<span style="color: #666666; font-style: italic;"># we see they fall into three categories: .58, .75, .84</span>
ci.func2<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> vmat<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># write version of make.data function in which the </span>
<span style="color: #666666; font-style: italic;"># difference-adjusted confidence level is an argument</span>
make.data4 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #339933;">,</span>model<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;">#variance-covariance matrix of the means</span>
vmat <span style="">&lt;-</span> cmat <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># levels of lh and n, means, and standard errors</span>
part1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span>
est=<a href="http://inside-r.org/r-doc/base/as.vector"><span style="color: #003399; font-weight: bold;">as.vector</span></a><span style="color: #009900;">&#40;</span>cmat<span style="">%*%</span><a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> se=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>vmat<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% intervals</span>
part1<span style="">$</span>low95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># difference-adjusted intervals</span>
part1<span style="">$</span>low85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># return value of function</span>
part1
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># redo using .84 for the difference-adjusted confidence intervals</span>
fac.vals <span style="">&lt;-</span> make.data4<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.84</span><span style="color: #339933;">,</span>lme.model2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># generate the graph: we see that we draw the same conclusions as with .75</span>
<a href="http://inside-r.org/r-doc/grDevices/windows"><span style="color: #003399; font-weight: bold;">windows</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>est<span style="">~</span>L<span style="">|</span>factor<span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span> level=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'P = '</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
xlab =<span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Estimated mean'</span><span style="color: #339933;">,</span> groups=N<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=fac.vals<span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> prepanel=prepanel.ci2<span style="color: #339933;">,</span> ly=fac.vals<span style="">$</span>low95<span style="color: #339933;">,</span> 
uy=fac.vals<span style="">$</span>up95<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> panel.groups=my.panel<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<span style="color: #0000ff;">&quot;panel.superpose&quot;</span><span style="color: #339933;">,</span>
key=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> y=<span style="color: #cc66cc;">.82</span><span style="color: #339933;">,</span> corner=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/points"><span style="color: #003399; font-weight: bold;">points</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.9</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/graphics/text"><span style="color: #003399; font-weight: bold;">text</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'N = 1'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'N = 0'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.8</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># rewrite make.data function so that it returns two difference-adjusted intervals</span>
make.data5 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #339933;">,</span>vals2<span style="color: #339933;">,</span> model<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;">#variance-covariance matrix of the means</span>
vmat <span style="">&lt;-</span> cmat <span style="">%*%</span> <a href="http://inside-r.org/r-doc/stats/vcov"><span style="color: #003399; font-weight: bold;">vcov</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span> <span style="">%*%</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">&#40;</span>cmat<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># levels of lh and n, means, and standard errors</span>
part1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>g<span style="color: #339933;">,</span>
est=<a href="http://inside-r.org/r-doc/base/as.vector"><span style="color: #003399; font-weight: bold;">as.vector</span></a><span style="color: #009900;">&#40;</span>cmat<span style="">%*%</span><a href="http://inside-r.org/r-doc/nlme/fixef"><span style="color: #003399; font-weight: bold;">fixef</span></a><span style="color: #009900;">&#40;</span>model<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> se=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">&#40;</span>vmat<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># 95% intervals</span>
part1<span style="">$</span>low95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.025</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up95 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.975</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># difference-adjusted intervals</span>
part1<span style="">$</span>low85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up85 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals1<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>low58 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
part1<span style="">$</span>up58 <span style="">&lt;-</span> part1<span style="">$</span>est <span style="">+</span> <a href="http://inside-r.org/r-doc/stats/qnorm"><span style="color: #003399; font-weight: bold;">qnorm</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">-</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399; font-weight: bold;">min</span></a><span style="color: #009900;">&#40;</span>vals2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="">/</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="">*</span>part1<span style="">$</span>se
<span style="color: #666666; font-style: italic;"># return value of function</span>
part1
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># obtain data</span>
fac.vals <span style="">&lt;-</span> make.data5<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.75</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.58</span><span style="color: #339933;">,</span>lme.model2<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># rewrite group panels function so that it draws two difference-adjusted intervals</span>
&nbsp;
 my.panel2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #339933;">,</span> pch<span style="color: #339933;">,</span> group.number<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #666666; font-style: italic;">#subset variables for the current panel</span>
low95 <span style="">&lt;-</span> fac.vals<span style="">$</span>low95<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
up95 <span style="">&lt;-</span> fac.vals<span style="">$</span>up95<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
low85 <span style="">&lt;-</span> fac.vals<span style="">$</span>low85<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
up85 <span style="">&lt;-</span> fac.vals<span style="">$</span>up85<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
low58 <span style="">&lt;-</span> fac.vals<span style="">$</span>low58<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
up58 <span style="">&lt;-</span> fac.vals<span style="">$</span>up58<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span>
myjitter <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="">-</span><span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.05</span><span style="color: #009900;">&#41;</span>
col2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'tomato'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'grey60'</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">#95% confidence interval</span>
<a href="http://inside-r.org/r-doc/lattice/panel.arrows"><span style="color: #003399; font-weight: bold;">panel.arrows</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> low95<span style="color: #339933;">,</span> x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> up95<span style="color: #339933;">,</span> angle=<span style="color: #cc66cc;">90</span><span style="color: #339933;">,</span> code=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a>=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">#difference-adjusted confidence interval</span>
<a href="http://inside-r.org/r-doc/lattice/panel.segments"><span style="color: #003399; font-weight: bold;">panel.segments</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> low85<span style="color: #339933;">,</span> x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> up85<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=col2<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> lineend=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.segments"><span style="color: #003399; font-weight: bold;">panel.segments</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> low58<span style="color: #339933;">,</span> x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> up58<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'dodgerblue1'</span><span style="color: #339933;">,</span> lineend=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">8</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># connect means with line segments</span>
<a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># add point estimates for the means</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'white'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.xyplot"><span style="color: #003399; font-weight: bold;">panel.xyplot</span></a><span style="color: #009900;">&#40;</span>x<span style="">+</span>myjitter<span style="color: #009900;">&#91;</span>group.number<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #339933;">,</span> pch=pch<span style="color: #339933;">,</span> ...<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># grid lines</span>
<a href="http://inside-r.org/r-doc/lattice/panel.abline"><span style="color: #003399; font-weight: bold;">panel.abline</span></a><span style="color: #009900;">&#40;</span>h=<a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">70</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'lightgrey'</span><span style="color: #339933;">,</span> lty=<span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># generate graph</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>est<span style="">~</span>L<span style="">|</span>factor<span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span> level=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'P = '</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
xlab =<span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Estimated mean'</span><span style="color: #339933;">,</span> groups=N<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=fac.vals<span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> prepanel=prepanel.ci2<span style="color: #339933;">,</span> ly=fac.vals<span style="">$</span>low95<span style="color: #339933;">,</span> 
uy=fac.vals<span style="">$</span>up95<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> panel.groups=my.panel2<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<span style="color: #0000ff;">&quot;panel.superpose&quot;</span><span style="color: #339933;">,</span>
key=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> y=<span style="color: #cc66cc;">.82</span><span style="color: #339933;">,</span> corner=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/points"><span style="color: #003399; font-weight: bold;">points</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.9</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/graphics/text"><span style="color: #003399; font-weight: bold;">text</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'N = 1'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'N = 0'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.8</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># we do not need both the .58 and the .75 intervals</span>
<span style="color: #666666; font-style: italic;"># use just .58 interval</span>
fac.vals <span style="">&lt;-</span> make.data4<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">.58</span><span style="color: #339933;">,</span>lme.model2<span style="color: #009900;">&#41;</span>
&nbsp;
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>est<span style="">~</span>L<span style="">|</span>factor<span style="color: #009900;">&#40;</span>P<span style="color: #339933;">,</span> level=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'P = '</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'absent'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'present'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sep=<span style="color: #0000ff;">''</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
xlab =<span style="color: #0000ff;">'L'</span><span style="color: #339933;">,</span> ylab=<span style="color: #0000ff;">'Estimated mean'</span><span style="color: #339933;">,</span> groups=N<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=fac.vals<span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> prepanel=prepanel.ci2<span style="color: #339933;">,</span> ly=fac.vals<span style="">$</span>low95<span style="color: #339933;">,</span> 
uy=fac.vals<span style="">$</span>up95<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> panel.groups=my.panel<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<span style="color: #0000ff;">&quot;panel.superpose&quot;</span><span style="color: #339933;">,</span>
key=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>x=<span style="color: #cc66cc;">.05</span><span style="color: #339933;">,</span> y=<span style="color: #cc66cc;">.82</span><span style="color: #339933;">,</span> corner=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/points"><span style="color: #003399; font-weight: bold;">points</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>pch=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.9</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/r-doc/graphics/text"><span style="color: #003399; font-weight: bold;">text</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'N = 1'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'N = 0'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> cex=<span style="color: #cc66cc;">.8</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">#### repeated measures design ####</span>
&nbsp;
turtles <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'ecol 563/turtles.txt'</span><span style="color: #339933;">, </span>header=T<span style="color: #009900;">&#41;</span>
turtles
&nbsp;
<span style="color: #666666; font-style: italic;"># reorder the treatment variable</span>
turtles<span style="">$</span>treat <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399; font-weight: bold;">factor</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'fed'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'fast10'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'fast20'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># separate groups panel graph</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #009900;">&#41;</span>
&nbsp;
out2 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">*</span>sex<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out2<span style="color: #009900;">&#41;</span>
out1 <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/nlme/lme"><span style="color: #003399; font-weight: bold;">lme</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">+</span>sex<span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/random"><span style="">random</span></a>=<span style="">~</span><span style="color: #cc66cc;">1</span><span style="">|</span>subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/stats/anova"><span style="color: #003399; font-weight: bold;">anova</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;"># we saw last time using MCMC that sex should be retained</span>
&nbsp;
&nbsp;
<span style="color: #666666; font-style: italic;"># panel function version of separate groups plot</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">, </span>y<span style="color: #339933;">, </span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
fems <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #339933;">,</span> newdata=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>treat=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sex=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'female'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> level=<span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
fems
males <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">&#40;</span>out1<span style="color: #339933;">,</span> newdata=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>treat=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sex=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'male'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> level=<span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
males
&nbsp;
<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span>treat=<a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">&#40;</span>turtles<span style="">$</span>treat<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> sex=<a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'male'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># add marginal means separately for each sex</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span>
 sex <span style="">&lt;-</span> turtles<span style="">$</span>sex<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span>
 <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>sex<span style="">==</span><span style="color: #0000ff;">'male'</span><span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> males<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">else</span>
<a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> fems<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># change individual trajectory colors to gray70</span>
<a href="http://inside-r.org/r-doc/lattice/xyplot"><span style="color: #003399; font-weight: bold;">xyplot</span></a><span style="color: #009900;">&#40;</span>plasma<span style="">~</span>treat<span style="">|</span>sex<span style="color: #339933;">,</span> groups=subject<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=turtles<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> 
<a href="http://inside-r.org/packages/cran/panel"><span style="">panel</span></a>=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
 <a href="http://inside-r.org/r-doc/lattice/panel.superpose"><span style="color: #003399; font-weight: bold;">panel.superpose</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> subscripts<span style="color: #339933;">,</span> groups<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #0000ff;">'grey70'</span><span style="color: #339933;">,</span>...<span style="color: #009900;">&#41;</span>
 sex <span style="">&lt;-</span> turtles<span style="">$</span>sex<span style="color: #009900;">&#91;</span>subscripts<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span>
 <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>sex<span style="">==</span><span style="color: #0000ff;">'male'</span><span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> males<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">else</span>
<a href="http://inside-r.org/r-doc/lattice/panel.lines"><span style="color: #003399; font-weight: bold;">panel.lines</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> fems<span style="color: #339933;">,</span> type=<span style="color: #0000ff;">'o'</span><span style="color: #339933;">,</span> pch=<span style="color: #cc66cc;">8</span><span style="color: #339933;">,</span> lwd=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span></pre></div></div><p><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></p>
</body>
</html>
